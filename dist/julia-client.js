"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("etch")),n=e(require("shell")),i=require("atom"),o=e(i),r=require("underscore-plus"),a=e(r),s=e(require("path")),l=e(require("fs")),u=e(require("child_process")),c=e(require("net")),d=e(require("object-hash")),f=e(require("physical-cpu-count")),p=require("node-pty-prebuilt-multiarch"),m=require("ssh2"),h=e(require("semver"));require("remote");var g=e(require("atom-select-list")),v=require("electron"),b=e(v),w=e(require("vm")),y=e(require("atom-package-deps"));function k(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){k(r,i,o,a,s,"next",e)}function s(e){k(r,i,o,a,s,"throw",e)}a(void 0)}))}}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function S(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||E(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function T(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=E(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o,r=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return r=e.done,e},e:function(e){a=!0,o=e},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw o}}}}function R(e){var t,n=null,i=T(e.getScopeDescriptor().scopes);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.startsWith("source.embedded.")){n=o;break}}}catch(e){i.e(e)}finally{i.f()}return n}function L(e,t){var n=R(t);if(null===n)return null;for(var i=t.getBufferRow(),o=i;i-1>=0&&e.scopeDescriptorForBufferPosition([i-1,0]).scopes.indexOf(n)>-1;)i-=1;for(;o+1<=e.getLastBufferRow()&&e.scopeDescriptorForBufferPosition([o+1,0]).scopes.indexOf(n)>-1;)o+=1;return[[i,0],[o,1/0]]}function A(e){var t,n=[],i=T(e.getCursors());try{for(i.s();!(t=i.n()).done;){var o=L(e,t.value);null!==o&&n.push(o)}}catch(e){i.e(e)}finally{i.f()}return n}function B(e){var t,n=T(e.getCursors());try{for(n.s();!(t=n.n()).done;){var i=t.value,o=R(i);if(null===o)return null;for(var r=L(e,i)[1][0]+1;r+1<=e.getLastBufferRow()&&-1===e.scopeDescriptorForBufferPosition([r+1,0]).scopes.indexOf(o);)r+=1;i.setBufferPosition([r+1,1/0])}}catch(e){n.e(e)}finally{n.f()}}function _(e){var t,n=T(e.getCursors());try{for(n.s();!(t=n.n()).done;){var i=t.value,o=R(i);if(null===o)return null;for(var r=L(e,i)[0][0]-1;r-1>=0&&-1===e.scopeDescriptorForBufferPosition([r-1,0]).scopes.indexOf(o);)r-=1;i.setBufferPosition([r-1,1/0])}}catch(e){n.e(e)}finally{n.f()}}function M(e){var t=A(e);if(0===t.length)return[];var n,i=[],o=T(t);try{for(o.s();!(n=o.n()).done;){var r=n.value,a=e.getTextInBufferRange(r);r[1][0]+=1,i.push({range:r,selection:e.getSelections()[0],line:r[0][0],text:a||" "})}}catch(e){o.e(e)}finally{o.f()}return i}var F=Object.freeze({__proto__:null,getCode:function(e){for(var t=e.getText().split("\n"),n=e.getLineCount(),i="",o=0;o<n;o++){var r=e.scopeDescriptorForBufferPosition([o,0]).scopes;r.length>1&&r.indexOf("source.embedded.julia")>-1&&(i+=t[o]+"\n")}return i},getCursorCellRanges:A,moveNext:B,movePrev:_,get:M}),J=["source.julia","source.embedded.julia"],z=["if","while","for","begin","function","macro","module","baremodule","type","immutable","struct","mutable struct","try","let","do","quote","abstract type","primitive type"],N=["else","elseif","catch","finally"];function H(e){var t,n=!1,i=!1,o=T(e);try{for(o.s();!(t=o.n()).done;){var r=t.value;r.indexOf("string")>-1&&(n=!0),r.indexOf("interpolation")>-1&&(i=!0)}}catch(e){o.e(e)}finally{o.f()}return n&&!i}function V(e,t,n){var o=new i.Point(t,0),r=new i.Point(n,1/0);return function(e,t){var n=atom.grammars.grammarForScopeName("source.julia");if(void 0===n)return[];var i=[],o=0,r=0,a=e.getTextInBufferRange(t);return n.tokenizeLines(a).forEach((function(e){e.forEach((function(e){var t=e.value;if(!H(e.scopes)){if(o>0&&")"===t)return o-=1,void i.splice(i.lastIndexOf("paren"),1);if(r>0&&"]"===t)return r-=1,void i.splice(i.lastIndexOf("bracket"),1);if("("===t)return o+=1,void i.push("paren");if("["===t)return r+=1,void i.push("bracket")}if(function(e){return e.slice(1).some((function(e){return e.indexOf("keyword")>-1}))}(e.scopes)&&0===o&&0===r){var n=N.includes(t);("end"===t||n)&&i.pop(),(z.includes(t)||n)&&i.push(t)}}))})),i}(e,new i.Range(o,r))}function W(e){return e.slice(1).some((function(e){return e.indexOf("comment")>-1}))}function q(e,t){var n=e.scopeDescriptorForBufferPosition(t).getScopesArray();return!!n.some((function(e){return J.includes(e)}))&&(!W(n)&&!H(n))}var U=Object.freeze({__proto__:null,isStringScope:H,forLines:V,isCommentScope:W,isValidScopeToInspect:q});function $(e,t){return{scope:e.scopeDescriptorForBufferPosition([t,0]).scopes,line:e.getTextInBufferRange([[t,0],[t,1/0]])}}function G(e){var t,n=e.line,i=e.scope,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=T(i);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(/\bcomment\b/.test(a)||!o&&/\bdocstring\b/.test(a))return!0}}catch(e){r.e(e)}finally{r.f()}return/^\s*(#.*)?$/.test(n)}function K(e){var t=e.line;return!!Y({line:t,scope:e.scope})||/^(end\b|\)|\]|\})/.test(t)}function Y(e){e.line;var t=e.scope;return t=t.join(" "),/\bstring\.multiline\.end\b/.test(t)||/\bstring\.end\b/.test(t)&&/\bbacktick\b/.test(t)}function Z(e){return!(/^\s/.test(e.line)||G(e)||K(e)||(t=e,n=t.line,i=t.scope,i=i.join(" "),/\bstring\b/.test(i)&&!/\bpunctuation\.definition\.string\b/.test(i)||n.match(/^(else|elseif|catch|finally)\b/)));var t,n,i}function X(e,t){for(var n=t,i=t;i<e.getLastBufferRow();){var o=$(e,++i);if(Z(o))break;K(o)?(0!==V(e,t,i-1).length||Y(o))&&(n=i):G(o)||Z(o)||(n=i)}return n}function Q(e,t){var n=function(e,t){for(;t>0&&!Z($(e,t));)t--;return t}(e,t),i=X(e,n);if(n<=t&&t<=i)return[[n,0],[i,1/0]]}function ee(e,t){for(var n=t.getBufferRange(),i=n.start,o=n.end,r=[[i.row,i.column],[o.row,o.column]];G($(e,r[0][0]),!0)&&r[0][0]<=r[1][0];)r[0][0]++,r[0][1]=0;for(;G($(e,r[1][0]),!0)&&r[1][0]>=r[0][0];)r[1][0]--,r[1][1]=1/0;return r}function te(e,t){var n=Q(e,t);return{context:n?e.getTextInBufferRange(n):"",startRow:n?n[0][0]:0}}var ne=Object.freeze({__proto__:null,getLine:$,moveNext:function(e,t,n){for(var i,o=n[1][0];(i=e.getLastBufferRow())<o+2&&(i===o||G($(e,i)));)t.setBufferRange([[i,1/0],[i,1/0]]),t.insertText("\n");for(var r=o+1;r<e.getLastBufferRow()&&G($(e,r));)r++;return r=X(e,r),t.setBufferRange([[r,1/0],[r,1/0]])},get:function(e){return function(e){return e.getSelections().map((function(t){return{selection:t,range:t.isEmpty()?Q(e,t.getHeadBufferPosition().row):ee(e,t)}})).filter((function(t){var n=t.range;return n&&e.getTextInBufferRange(n).trim()}))}(e).map((function(t){var n=t.range;return{range:n,selection:t.selection,line:n[0][0],text:e.getTextInBufferRange(n)}}))},getLocalContext:te,select:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:atom.workspace.getActiveTextEditor();if(e)return e.mutateSelectedText((function(t){var n=Q(e,t.getHeadBufferPosition().row);n&&t.setBufferRange(n)}))}});function ie(e){var t=e.getBuffer(),n=t.getFirstPosition(),i=t.getEndPosition(),o="^("+atom.config.get("julia-client.uiOptions.cellDelimiter").join("|")+")",r=new RegExp(o),a=e.getCursorBufferPosition();a.column=1/0;for(var s=!1,l=a.row+1;l<=e.getLastBufferRow();l++){var u=$(e,l),c=u.line,d=u.scope;if(s=r.test(c)&&d.join(".").indexOf("comment.line")>-1,i.row=l,s)break}if(s&&(i.row-=1,i.row<0&&(i.row=0),i.column=1/0),s=!1,a.row>0){for(var f=i.row;f>=0;f--){var p=$(e,f),m=p.line,h=p.scope;if(s=r.test(m)&&h.join(".").indexOf("comment.line")>-1,n.row=f,s)break}n.column=0}return[n,i]}var oe,re,ae,se=Object.freeze({__proto__:null,getRange:ie,get:function(e){return e.getGrammar().scopeName.indexOf("source.julia")>-1?function(e){var t=ie(e),n=e.getTextInBufferRange(t);""===n.trim()&&(n=" ");return[{range:[[t[0].row,t[0].column],[t[1].row,t[1].column]],selection:e.getSelections()[0],line:t[0].row,text:n}]}(e):M(e)},moveNext:function(e){return null==e&&(e=atom.workspace.getActiveTextEditor()),e.getGrammar().scopeName.indexOf("source.julia")>-1?function(e){var t=ie(e),n=e.getSelections()[0],i=t[1].row+2;return n.setBufferRange([[i,0],[i,0]])}(e):B(e)},movePrev:function(e){return null==e&&(e=atom.workspace.getActiveTextEditor()),e.getGrammar().scopeName.indexOf("source.weave")>-1?_(e):function(e){var t=ie(e)[0].row-2;return e.getSelections()[0].setBufferRange([[t,0],[t,0]])}(e)}});ae=n,re=se,({CompositeDisposable:oe}=o);var le={activate:function(e){var t,n,i,o,r,a,s,l;for(s=function(t,n){return e.connection.client.require(t,n)},i=function(t,n){return e.connection.client.disrequire(t,n)},t=function(){return e.connection.boot()},n=function(e){return atom.commands.dispatch(e.currentTarget,"autocomplete-plus:cancel")},this.subs=new oe,o=0,r=(a=atom.config.get("julia-client.juliaSyntaxScopes")).length;o<r;o++)l=a[o],this.subs.add(atom.commands.add(`atom-text-editor[data-grammar='${l.replace(/\./g," ")}']`,{"julia-client:run-block":i=>(n(i),this.withInk((function(){return t(),e.runtime.evaluation.eval()}))),"julia-client:run-and-move":n=>this.withInk((function(){return t(),e.runtime.evaluation.eval({move:!0})})),"julia-client:run-all":i=>(n(i),this.withInk((function(){return t(),e.runtime.evaluation.evalAll()}))),"julia-client:run-cell":()=>this.withInk((function(){return t(),e.runtime.evaluation.eval({cell:!0})})),"julia-client:run-cell-and-move":()=>this.withInk((function(){return t(),e.runtime.evaluation.eval({cell:!0,move:!0})})),"julia-client:select-block":()=>e.misc.blocks.select(),"julia-client:next-cell":()=>re.moveNext(),"julia-client:prev-cell":()=>re.movePrev(),"julia-client:goto-symbol":()=>this.withInk((function(){return t(),e.runtime.goto.gotoSymbol()})),"julia-client:show-documentation":()=>this.withInk((function(){return t(),e.runtime.evaluation.toggleDocs()})),"julia-client:send-to-stdin":t=>s((function(){var n,i,o,r,a,s;for(n=!1,o=0,r=(a=(i=t.currentTarget.getModel()).getSelections()).length;o<r;o++)(s=a[o]).getText()&&(n=!0,e.connection.client.stdin(s.getText()));if(!n)return e.connection.client.stdin(i.getText())})),"julia-debug:run-block":()=>this.withInk((function(){return t(),e.runtime.debugger.debugBlock(!1,!1)})),"julia-debug:step-through-block":()=>this.withInk((function(){return t(),e.runtime.debugger.debugBlock(!0,!1)})),"julia-debug:run-cell":()=>this.withInk((function(){return t(),e.runtime.debugger.debugBlock(!1,!0)})),"julia-debug:step-through-cell":()=>this.withInk((function(){return t(),e.runtime.debugger.debugBlock(!0,!0)})),"julia-debug:toggle-breakpoint":()=>this.withInk((function(){return t(),e.runtime.debugger.togglebp()})),"julia-debug:toggle-conditional-breakpoint":()=>this.withInk((function(){return t(),e.runtime.debugger.togglebp(!0)}))}));return this.subs.add(atom.commands.add('atom-text-editor[data-grammar="source julia"]',{"julia-client:format-code":()=>this.withInk((function(){return t(),e.runtime.formatter.formatCode()}))})),this.subs.add(atom.commands.add('atom-text-editor[data-grammar="source julia"], .julia-terminal, .ink-workspace',{"julia-client:set-working-module":function(){return e.runtime.modules.chooseModule()}})),this.subs.add(atom.commands.add(".tree-view",{"julia-client:run-all":i=>(n(i),this.withInk((function(){return t(),e.runtime.evaluation.evalAll(i.target)}))),"julia-debug:run-file":n=>this.withInk((function(){return t(),e.runtime.debugger.debugFile(!1,n.target)})),"julia-debug:step-through-file":n=>this.withInk((function(){return t(),e.runtime.debugger.debugFile(!0,n.target)}))})),this.subs.add(atom.commands.add("atom-workspace",{"julia-client:open-external-REPL":function(){return e.connection.terminal.repl()},"julia-client:start-julia":function(){return i("boot Julia",(function(){return t()}))},"julia-client:start-remote-julia-process":function(){return i("boot a remote Julia process",(function(){return e.connection.bootRemote()}))},"julia-client:kill-julia":function(){return e.connection.client.kill()},"julia-client:interrupt-julia":()=>s("interrupt Julia",(function(){return e.connection.client.interrupt()})),"julia-client:disconnect-julia":()=>s("disconnect Julia",(function(){return e.connection.client.disconnect()})),"julia-client:connect-external-process":function(){return i((function(){return e.connection.messages.connectExternal()}))},"julia-client:connect-terminal":function(){return i((function(){return e.connection.terminal.connectedRepl()}))},"julia-client:open-plot-pane":()=>this.withInk((function(){return e.runtime.plots.open()})),"julia-client:open-outline-pane":()=>this.withInk((function(){return e.runtime.outline.open()})),"julia-client:open-workspace":()=>this.withInk((function(){return e.runtime.workspace.open()})),"julia-client:restore-default-layout":function(){return e.ui.layout.restoreDefaultLayout()},"julia-client:close-juno-panes":function(){return e.ui.layout.closePromises()},"julia-client:reset-default-layout-settings":function(){return e.ui.layout.resetDefaultLayoutSettings()},"julia-client:settings":function(){return atom.workspace.open("atom://config/packages/julia-client")},"julia-debug:run-file":()=>this.withInk((function(){return t(),e.runtime.debugger.debugFile(!1)})),"julia-debug:step-through-file":()=>this.withInk((function(){return t(),e.runtime.debugger.debugFile(!0)})),"julia-debug:clear-all-breakpoints":()=>e.runtime.debugger.clearbps(),"julia-debug:step-to-next-line":t=>e.runtime.debugger.nextline(t),"julia-debug:step-to-selected-line":t=>e.runtime.debugger.toselectedline(t),"julia-debug:step-to-next-expression":t=>e.runtime.debugger.stepexpr(t),"julia-debug:step-into":t=>e.runtime.debugger.stepin(t),"julia-debug:stop-debugging":t=>e.runtime.debugger.stop(t),"julia-debug:step-out":t=>e.runtime.debugger.finish(t),"julia-debug:continue":t=>e.runtime.debugger.continueForward(t),"julia-debug:open-debugger-pane":()=>e.runtime.debugger.open(),"julia:new-julia-file":()=>atom.workspace.open().then(e=>{var t;if(t=atom.grammars.grammarForScopeName("source.julia"))return e.setGrammar(t)}),"julia:open-julia-startup-file":function(){return atom.workspace.open(e.misc.paths.home(".julia","config","startup.jl"))},"julia:open-juno-startup-file":function(){return atom.workspace.open(e.misc.paths.home(".julia","config","juno_startup.jl"))},"julia:open-julia-home":function(){return ae.openItem(e.misc.paths.juliaHome())},"julia:open-package-in-new-window":function(){return s("get packages",(function(){return e.runtime.packages.openPackage()}))},"julia:open-package-as-project-folder":function(){return s("get packages",(function(){return e.runtime.packages.openPackage(!1)}))},"julia:get-help":function(){return ae.openExternal("http://discourse.julialang.org")},"julia-client:debug-info":()=>(t(),e.runtime.debuginfo()),"julia-client:work-in-current-folder":function(t){return s("change working folder",(function(){return e.runtime.evaluation.cdHere(t.target)}))},"julia-client:work-in-project-folder":function(){return s("change working folder",(function(){return e.runtime.evaluation.cdProject()}))},"julia-client:work-in-home-folder":function(){return s("change working folder",(function(){return e.runtime.evaluation.cdHome()}))},"julia-client:select-working-folder":function(){return s("change working folder",(function(){return e.runtime.evaluation.cdSelect()}))},"julia-client:activate-environment-in-current-folder":function(t){return s("activate an environment",(function(){return e.runtime.evaluation.activateProject(t.target)}))},"julia-client:activate-environment-in-parent-folder":function(t){return s("activate an environment",(function(){return e.runtime.evaluation.activateParentProject(t.target)}))},"julia-client:activate-default-environment":function(t){return s("activate an environment",(function(){return e.runtime.evaluation.activateDefaultProject()}))}}))},deactivate:function(){return this.subs.dispose()},withInk:function(e,t){return null!=this.ink?e():t?atom.notifications.addError("Please install the Ink package.",{detail:"Julia Client requires the Ink package to run. You can install it via `File -> Settings -> Install`.",dismissable:!0}):setTimeout(()=>this.withInk(e,!0),100)}};function ue(){for(var e="win32"===process.platform?"USERPROFILE":"HOME",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return s.join.apply(s,[process.env[e]].concat(n))}function ce(){return de(atom.config.get("julia-client.juliaPath"))}function de(e){return e.startsWith("~")?e.replace("~",ue()):e}function fe(){var e=atom.workspace.project.getDirectories(),t=process.env.HOME;return t||(t=process.env.USERPROFILE),0===e.length||e[0].path.match("app.asar")?Promise.resolve(t):new Promise((function(n){try{l.stat(e[0].path,(function(i,o){return i?n(t):o.isFile()?n(s.dirname(e[0].path)):n(e[0].path)}))}catch(e){return n(t)}}))}function pe(){for(var e=s.resolve(__dirname,"..",".."),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return s.join.apply(s,[e].concat(n))}var me=Object.freeze({__proto__:null,home:ue,juliaHome:function(){for(var e=process.env.JULIA_HOME||ue(".julia"),t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return s.join.apply(s,[e].concat(n))},jlpath:ce,expandHome:de,fullPath:function(e){return new Promise((function(t,n){if(l.existsSync(e))return t(e);var i=process.cwd(),o=s.dirname(process.execPath);try{process.chdir(o);var r=l.realpathSync(e);l.existsSync(r)&&t(r)}catch(e){}finally{try{process.chdir(i)}catch(e){}}if("win32"===process.platform&&/[a-zA-Z]\:/.test(e))return n("Couldn't resolve path.");var a="win32"===process.platform?"where":"which";u.exec("".concat(a,' "').concat(e,'"'),(function(e,i,o){if(e)return n(o);var r=i.trim();return l.existsSync(r)?t(r):n("Couldn't resolve path.")}))}))},getVersion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce();return new Promise((function(t,n){u.exec('"'.concat(e,'" --version'),(function(e,i,o){if(e)return n(o);var r=i.match(/(\d+)\.(\d+)\.(\d+)/);if(!r)return n("Couldn't resolve version.");var a=O(r,4),s=(a[0],a[1]),l=a[2],u=a[3];return t({major:s,minor:l,patch:u})}))}))},projectDir:function(){return atom.config.get("julia-client.juliaOptions.persistWorkingDir")?new Promise((function(e){var t=atom.config.get("julia-client.juliaOptions.workingDir");try{l.stat(t,(function(n,i){return e(n?fe():t)}))}catch(t){return e(fe())}})):fe()},script:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return pe.apply(void 0,["script"].concat(t))},getPathFromTreeView:function(e){var t=e.closest("[data-path]");if(!t){var n=e.querySelector(".tree-view .selected");n&&(t=n.querySelector("[data-path]"))}return t?t.dataset.path:null},getDirPathFromTreeView:function(e){var t=e.closest(".directory");if(!t){var n=e.querySelector(".tree-view .selected");n&&(t=n.closest(".directory"))}if(t){var i=t.querySelector("[data-path]");if(i)return i.dataset.path}return null},readCode:function(e){return l.readFileSync(e,"utf-8")}}),he=/[\u00A0-\uFFFF\w_!´\.]*@?[\u00A0-\uFFFF\w_!´]+/;function ge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{bufferPosition:void 0,wordRegex:he},n=t.bufferPosition?t.bufferPosition:e.getLastCursor().getBufferPosition(),i=ve(e,n,{wordRegex:t.wordRegex?t.wordRegex:he}),o=e.getTextInBufferRange(i);return{word:o,range:i}}function ve(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{wordRegex:he},o=t.row,r=t.column,a=e.getBuffer().findAllInRangeSync(n.wordRegex?n.wordRegex:he,new i.Range(new i.Point(o,0),new i.Point(o,1/0))),s=a.find((function(e){return e.end.column>=r&&e.start.column<=r}));return s?i.Range.fromObject(s):new i.Range(t,t)}function be(e,t,n){var o,r=t.start,a=r.column,s=t.end.row,l=a,u=n.column,c=T(e.split("."));try{for(c.s();!(o=c.n()).done;){if(u<=(l+=o.value.length))break;l+=1}}catch(e){c.e(e)}finally{c.f()}var d=new i.Point(s,l);return new i.Range(r,d)}function we(e){return e.length>0&&isNaN(e)}var ye=Object.freeze({__proto__:null,wordRegex:he,withWord:function(e,t){var n=ge(e),i=n.word,o=n.range;we(i)&&t(i,o)},getWordAndRange:ge,getWordRangeAtBufferPosition:ve,getWordRangeWithoutTrailingDots:be,isValidWordToInspect:we});function ke(e){if(-1==e.search("rgb"))return e;var t=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};return t((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+t(e[2])+t(e[3])}var je,Pe,xe,Se,Ce=Object.freeze({__proto__:null,getColors:function(e){atom.grammars.grammarForScopeName("source.julia");var t={},n={},i=document.createElement("div");for(var o in i.classList.add("editor","editor-colors","julia-syntax-color-selector"),e){var r,a=document.createElement("span");a.innerText="foo",(r=a.classList).add.apply(r,D(e[o])),i.appendChild(a),t[o]=a}for(var s in document.body.appendChild(i),e)try{n[s]=ke(window.getComputedStyle(t[s]).color)}catch(e){}return n.background=ke(window.getComputedStyle(i).backgroundColor),document.body.removeChild(i),n}}),Oe=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t;({debounce:t}=a),e.exports={paths:me,blocks:ne,cells:se,words:ye,weave:F,colors:Ce,scopes:U,bufferLines:function(e,n){var i,o;return null==n&&([e,n]=[null,e]),i=[""],o=null==e?function(){}:t((function(){if(""!==i[0])return n(i[0],!1),i[0]=""}),e),function(e){var t;for(t=e.toString().split("\n"),i[0]+=t.shift(),i.push(...t);i.length>1;)n(i.shift(),!0);return o()}},time:function(e,t){return function(){return(new Date).getTime()/1e3}(),t.then((function(){})).catch((function(){})),t},hook:function(e,t,n){var i;return i=e[t].bind(e),e[t]=function(...e){return n(i,...e)}},once:function(e){var t;return t=!1,function(...n){if(!t)return t=!0,e.call(this,...n)}},mutex:function(){var e;return e=Promise.resolve(),function(t){var n,i;return n=e,i=null,e=new Promise((function(e){return i=e})).catch((function(){})),n.then(()=>t.call(this,i))}},exclusive:function(t){var n;return n=e.exports.mutex(),function(...e){return n(n=>{var i;return n(i=t.call(this,...e)),i})}},formatTimePeriod:function(e){var t,n,i,o;if(e>1){for(n in o=[t=Math.floor(e/3600),i=Math.floor((e-=60*t*60)/60),Math.round(e-60*i)])e=o[n],o[n]=e<10?"0"+e:""+e;return o.join(":")}}}})),De=Oe.paths,Ee=Oe.blocks,Ie=Oe.cells,Te=(Oe.words,Oe.weave,Oe.colors,Oe.scopes,Oe.bufferLines,Oe.time,Oe.hook,Oe.once,Oe.mutex);Oe.exclusive,Oe.formatTimePeriod;je=null,xe=[],Se=function(e){return null!=je?e():xe.push(e)},({bufferLines:Pe}=Oe);var Re,Le=class{static consumeInk(e){var t,n,i,o;for(je=e.Loading,o=[],n=0,i=xe.length;n<i;n++)t=xe[n],o.push(t());return o}constructor(e){Se(()=>this.loading=new je),this.handlers={},this.callbacks={},this.queue=[],this.id=0,null!=e&&this.setStream(e),this.handle({cb:(e,t)=>{var n;return null!=(n=this.callbacks[e])&&n.resolve(t),delete this.callbacks[e]},cancelCallback:(e,t)=>this.callbacks[e].reject(t)})}handle(e,t){var n,i;if(null!=t)return this.handlers[e]=t;for(i in n=[],e)t=e[i],n.push(this.handle(i,t));return n}writeMsg(){throw new Error("msg not implemented")}msg(e,...t){return this.writeMsg([e,...t])}rpc(e,...t){var n,i;return n=new Promise((n,i)=>(this.id+=1,this.callbacks[this.id]={resolve:n,reject:i},this.msg({type:e,callback:this.id},...t))),null!=(i=this.loading)?i.monitor(n):void 0}flush(){var e,t,n,i;for(e=0,t=(i=this.queue).length;e<t;e++)n=i[e],this.writeMsg(n);return this.queue=[]}reset(){var e,t,n;for(e in null!=(t=this.loading)&&t.reset(),this.queue=[],n=this.callbacks)n[e].reject("disconnected");return this.callbacks={}}input([e,...t]){var n,i;if(e.constructor===Object&&({type:e,callback:n}=e),this.handlers.hasOwnProperty(e))return i=Promise.resolve().then(()=>this.handlers[e](...t)),n?i.then(e=>this.msg("cb",n,e)).catch(e=>this.msg("cancelCallback",n,this.errJson(e))):void 0}import(e,t=!0,n={}){if(null!=e)return e.constructor===String?this.import([e],t,n)[e]:(null!=e.rpc||null!=e.msg?(n={},this.import(e.rpc,!0,n),this.import(e.msg,!1,n)):e.forEach(e=>n[e]=(...n)=>t?this.rpc(e,...n):this.msg(e,...n)),n)}isWorking(){var e;return null!=(e=this.loading)?e.isWorking():void 0}onWorking(e){var t;return null!=(t=this.loading)?t.onWorking(e):void 0}onDone(e){var t;return null!=(t=this.loading)?t.onDone(e):void 0}onceDone(e){var t;return null!=(t=this.loading)?t.onceDone(e):void 0}errJson(e){if(e instanceof Error)return{type:"error",message:e.message,stack:e.stack}}readStream(e){var t;return e.on("data",t=Pe(e=>{if(e)return this.input(JSON.parse(e))})),this.unreadStream=function(){return e.removeListener("data",t)}}writeStream(e){return this.writeMsg=function(t){return e.write(JSON.stringify(t)),e.write("\n")}}setStream(e){return this.stream=e,this.readStream(this.stream),this.writeStream(this.stream),this.stream.on("end",()=>this.reset())}};({Emitter:Re}=o);var Ae,Be,_e={ipc:new Le,handle:function(...e){return this.ipc.handle(...e)},input:function(e){return this.ipc.input(e)},readStream:function(e){return this.ipc.readStream(e)},import:function(...e){return this.ipc.import(...e)},activate:function(){var e;return this.emitter=new Re,this.bootMode=atom.config.get("julia-client.juliaOptions.bootMode"),this.ipc.writeMsg=e=>{var t;return this.isActive()&&!1!==("function"==typeof(t=this.conn).ready?t.ready():void 0)?this.conn.message(e):this.ipc.queue.push(e)},this.handle("error",e=>(atom.config.get("julia-client.uiOptions.errorNotifications")&&atom.notifications.addError(e.msg,e),atom.beep())),e=null,this.onAttached(()=>{var t;return t=atom.config.get("julia-client.juliaOptions.arguments"),this.import("connected")(),t.length>0&&this.import("args")(t),e=atom.config.observe("julia-client.uiOptions.usePlotPane",e=>this.import("enableplotpane")(e))}),this.onDetached(()=>null!=e?e.dispose():void 0),this.onBoot(e=>this.remoteConfig=e.config)},setBootMode:function(e){this.bootMode=e},editorPath:function(e){var t,n;return null==e?e:"Remote"===this.bootMode&&null!=this.remoteConfig?null==(n=e.getPath())?n:(t=n.indexOf(this.remoteConfig.host))>-1?n=(n=n.slice(t+this.remoteConfig.host.length,n.length)).replace(/\\/g,"/"):n:e.getPath()},deactivate:function(){if(this.emitter.dispose(),this.isActive())return this.detach()},basicHandlers:{},basicHandler:function(e){var t,n,i;if(n=e.toString().match(/juno-msg-(.*)/))return"function"==typeof(t=this.basicHandlers)[i=n[1]]&&t[i](),!0},handleBasic:function(e,t){return this.basicHandlers[e]=t},emitter:new Re,onAttached:function(e){return this.emitter.on("attached",e)},onDetached:function(e){return this.emitter.on("detached",e)},onceAttached:function(e){var t;return t=this.onAttached((function(...n){return t.dispose(),e.call(this,...n)}))},isActive:function(){return null!=this.conn},attach:function(e){var t;return this.conn=e,!1!==("function"==typeof(t=this.conn).ready?t.ready():void 0)&&this.flush(),this.emitter.emit("attached")},detach:function(){return delete this.conn,this.ipc.reset(),this.emitter.emit("detached")},flush:function(){return this.ipc.flush()},isWorking:function(){return this.ipc.isWorking()},onWorking:function(e){return this.ipc.onWorking(e)},onDone:function(e){return this.ipc.onDone(e)},onceDone:function(e){return this.ipc.onceDone(e)},onStdout:function(e){return this.emitter.on("stdout",e)},onStderr:function(e){return this.emitter.on("stderr",e)},onInfo:function(e){return this.emitter.on("info",e)},onBoot:function(e){return this.emitter.on("boot",e)},stdout:function(e){return this.emitter.emit("stdout",e)},stderr:function(e){if(!this.basicHandler(e))return this.emitter.emit("stderr",e)},info:function(e){return this.emitter.emit("info",e)},clientCall:function(e,t,...n){return null==this.conn[t]?atom.notifications.addError(`This client doesn't support ${e}.`):this.conn[t].call(this.conn,...n)},stdin:function(e){return this.clientCall("STDIN","stdin",e)},interrupt:function(){if(this.isActive())return this.clientCall("interrupts","interrupt")},disconnect:function(){if(this.isActive())return this.clientCall("disconnecting","disconnect")},kill:function(){return this.isActive()?this.isWorking()?this.clientCall("kill","kill"):this.import("exit")().catch((function(){})):this.ipc.reset()},clargs:function(){var e,t,n,i,o;return({precompiled:i,optimisationLevel:n,deprecationWarnings:t}=atom.config.get("julia-client.juliaOptions")),(e=[]).push("--depwarn="+(t?"yes":"no")),2!==n&&e.push("-O"+n),e.push("--color=yes"),e.push("-i"),(o=atom.config.get("julia-client.juliaOptions.startupArguments")).length>0&&(e=e.concat(o)),e=(e=e.map(e=>e.trim())).filter(e=>e.length>0)},connectedError:function(e="do that"){return!!this.isActive()&&(atom.notifications.addError(`Can't ${e} with a Julia client running.`,{description:"Stop the current client with `Packages -> Juno -> Stop Julia`."}),!0)},notConnectedError:function(e="do that"){return!this.isActive()&&(atom.notifications.addError(`Can't ${e} without a Julia client running.`,{description:"Start a client with `Packages -> Juno -> Start Julia`."}),!0)},require:function(e,t){return null!=t||([e,t]=[null,e]),this.notConnectedError(e)||t()},disrequire:function(e,t){return null!=t||([e,t]=[null,e]),this.connectedError(e)||t()},withCurrent:function(e){var t;return t=this.conn,(...n)=>{if(t===this.conn)return e(...n)}}};Be=c,Ae=_e;var Me,Fe,Je,ze,Ne={server:null,port:null,listeners:[],next:function(){var e;return(e=new Promise(e=>this.listeners.push(e))).dispose=()=>this.listeners=this.listeners.filter((function(t){return t===e})),e},connect:function(e){var t;return t=function(t){return e.write(JSON.stringify(t))},Ae.readStream(e),e.on("end",(function(){return Ae.detach()})),e.on("error",(function(){return Ae.detach()})),Ae.attach({message:t})},handle:function(e){return this.listeners.length>0?this.listeners.shift()(e):Ae.isActive()?e.end():this.connect(e)},listen:function(){return null!=this.port?Promise.resolve(this.port):new Promise((e,t)=>{var n,i;return n=atom.config.get("julia-client.juliaOptions.externalProcessPort"),i="random"===n?0:parseInt(n),this.server=Be.createServer(e=>this.handle(e)),this.server.on("error",e=>{var n;return"EADDRINUSE"===e.code&&(n="",0!==i&&(n="Please change to another port in the settings and try again."),atom.notifications.addError("Julia could not be started.",{description:`Port \`${i}\` is already in use.\n`+(""!==n?""+n:"Please try again or set a fixed port that you know is unused."),dismissable:!0})),t(e)}),this.server.listen(i,"127.0.0.1",()=>(this.port=this.server.address().port,e(this.port)))})}};Me=u,ze=Ne,Fe=_e,({paths:Je}=Oe);var He,Ve,We={escpath:function(e){return'"'+e+'"'},escape:function(e){return e.replace(/"/g,'\\"')},exec:function(e){return Me.exec(e,(function(e,t,n){}))},term:function(e){switch(process.platform){case"darwin":return this.exec("osascript -e 'tell application \"Terminal\" to activate'"),this.exec(`osascript -e 'tell application "Terminal" to do script "${this.escape(e)}"'`);case"win32":return this.exec(`${this.terminal()} "${e}"`);default:return this.exec(`${this.terminal()} "${this.escape(e)}"`)}},terminal:function(){return atom.config.get("julia-client.consoleOptions.terminal")},defaultShell:function(){var e;return null!=(e=process.env.SHELL)?e:"win32"===process.platform?"powershell.exe":"bash"},defaultTerminal:function(){return"win32"===process.platform?"cmd /C start cmd /C":"x-terminal-emulator -e"},repl:function(){return this.term(""+this.escpath(Je.jlpath()))},connectCommand:function(){return ze.listen().then(e=>`${this.escpath(Je.jlpath())} ${Fe.clargs().join(" ")} ${Je.script("boot_repl.jl")} ${e}`)},connectedRepl:function(){return this.connectCommand().then(e=>this.term(e))}};He=_e,Ve=Ne;var qe={activate:function(){return He.handleBasic("install",()=>{var e;return null!=(e=this.note)&&e.dismiss(),atom.notifications.addError("Error installing Atom.jl package",{description:'Go to the `Packages -> Juno -> Open REPL` menu and\nrun `Pkg.add("Atom")` in Julia, then try again.\nIf you still see an issue, please report it to:\n\nhttps://discourse.julialang.org/',dismissable:!0})}),He.handleBasic("load",()=>{var e;return null!=(e=this.note)&&e.dismiss(),atom.notifications.addError("Error loading Atom.jl package",{description:"Go to the `Packages -> Juno -> Open REPL` menu and\nrun `Pkg.update()` in Julia, then try again.\nIf you still see an issue, please report it to:\n\nhttps://discourse.julialang.org/",dismissable:!0})}),He.handleBasic("installing",()=>{var e;return null!=(e=this.note)&&e.dismiss(),this.note=atom.notifications.addInfo("Installing Julia packages...",{description:"Julia's first run will take a couple of minutes.\nSee the REPL below for progress.",dismissable:!0}),this.openConsole()}),He.handleBasic("precompiling",()=>{var e;return null!=(e=this.note)&&e.dismiss(),this.note=atom.notifications.addInfo("Compiling Julia packages...",{description:"Julia's first run will take a couple of minutes.\nSee the REPL below for progress.",dismissable:!0}),this.openConsole()}),He.handle({welcome:()=>{var e;return null!=(e=this.note)&&e.dismiss(),atom.notifications.addSuccess("Welcome to Juno!",{description:"Success! Juno is set up and ready to roll.\nTry entering `2+2` in the REPL below.",dismissable:!0}),this.openConsole()}})},openConsole:function(){return atom.commands.dispatch(atom.views.getView(atom.workspace),"julia-client:open-REPL")},jlNotFound:function(e,t=""){return atom.notifications.addError("Julia could not be started.",{description:`We tried to launch Julia from: \`${e}\`\nThis path can be changed in the settings.`,detail:t,dismissable:!0})},connectExternal:function(){return Ve.listen().then((function(e){var t,n;return t=`using Atom; using Juno; Juno.connect(${e})`,n=atom.notifications.addInfo("Connect an external process",{description:"To connect a Julia process running in the terminal, run the command:\n\n    "+t,dismissable:!0,buttons:[{text:"Copy",onDidClick:function(){return atom.clipboard.write(t)}}]}),He.onceAttached((function(){return n.isDismissed()||n.dismiss(),atom.notifications.addSuccess("Julia is connected.")}))}))}},Ue=qe.jlNotFound,$e=Te();function Ge(e,t){return function(e,t,n){return new Promise((function(i,o){Ne.listen().then((function(r){De.fullPath(e).then((function(e){De.projectDir().then((function(a){var s=p.spawn(e,[].concat(D(t),[De.script("boot_repl.jl")," ".concat(r)]),{cols:100,rows:30,env:n,cwd:a,useConpty:!0,handleFlowControl:!0}),l=function(e){return conn=Ne.next(),failure=new Promise((function(t,n){e.on("exit",(function(e){conn.dispose(),n(e)}))})),Promise.race([conn,failure])}(s);l.catch((function(e){o(e)})),i({ty:s,kill:function(){if(s._readable||s._writable)try{s.kill()}catch(e){}},interrupt:function(){try{s.write("")}catch(e){}},socket:l,onExit:function(e){try{s.on("exit",e)}catch(e){}},onStderr:function(e){},onStdout:function(e){try{s.on("data",e)}catch(e){}}})})).catch((function(e){o(e)}))})).catch((function(t){Ue(e,t),o(t)}))})).catch((function(e){o(e)}))}))}(e,t,Ke())}function Ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:process.env,t=atom.config.get("julia-client.juliaOptions.numberOfThreads"),n=parseInt(t);return"auto"==t?e.JULIA_NUM_THREADS=f:0!=n&&isFinite(n)&&(e.JULIA_NUM_THREADS=n),atom.config.get("julia-client.disableProxy")&&(delete e.HTTP_PROXY,delete e.HTTPS_PROXY,delete e.http_proxy,delete e.https_proxy),e}var Ye,Ze,Xe,Qe=Object.freeze({__proto__:null,lock:$e,get:function(e,t){return $e((function(n){var i=Ge(e,t);return i.catch((function(e){n()})),n(i.then((function(e){return e.socket}))),i}))},get_:Ge,customEnv:Ke});Xe=d,Ze=Qe,Ye=Le;var et={provider:function(){return Ze},cacheLength:1,procs:{},key:function(e,t){return Xe([e,...t].join(" ").trim())},cache:function(e,t){var n,i;return null!=(n=this.procs)[i=this.key(e,t)]?n[i]:n[i]=[]},removeFromCache:function(e,t,n){var i;return i=this.key(e,t),this.procs[i]=this.procs[i].filter((function(e){return e!==n}))},toCache:function(e,t,n){return n.cached=!0,this.cache(e,t).push(n)},fromCache:function(e,t){var n,i;if(i=this.cache(e,t),null!=(n=i.shift()))return n.cached=!1,n.init.then(()=>(this.start(e,t),n.proc))},start:function(e,t){var n;n=[t,atom.config.get("julia-client.juliaOptions")],this.provider().lock(i=>this.cache(e,n).length<this.cacheLength?this.provider().get_(e,t).then(t=>{var o;return o={path:e,allArgs:n,proc:t},this.monitor(t),this.warmup(o),this.toCache(e,n,o),t.socket.then(()=>this.start(e,n)).catch(t=>this.removeFromCache(e,n,o)),i(t.socket)}).catch(e=>i()):i())},flush:function(e,t,n){var i,o,r,a,s;for(a=[],o=0,r=e.length;o<r;o++)({type:s,data:i}=e[o]),a.push(("stdout"===s?t:n)(i));return a},monitor:function(e){return e.events=[],e.wasCached=!0,e.onStdout((function(t){var n;return null!=(n=e.events)?n.push({type:"stdout",data:t}):void 0})),e.onStderr((function(t){var n;return null!=(n=e.events)?n.push({type:"stderr",data:t}):void 0})),e.flush=(t,n)=>(this.flush(e.events,t,n),delete e.events)},boot:function(e){return e.rpc("ping")},repl:function(e){return e.rpc("changemodule",{mod:"Main"})},warmup:function(e){return e.init=Promise.resolve(),e.proc.socket.then(t=>{var n;e.cached&&(n=new Ye(t),[this.boot,this.repl].forEach((function(t){return e.init=e.init.then((function(){if(e.cached)return t(n)}))})),e.init=e.init.catch((function(e){})).then((function(){return n.unreadStream()})))}).catch((function(){}))},get:function(e,t){var n,i,o;return n=[t,atom.config.get("julia-client.juliaOptions")],i=(o=this.fromCache(e,n))?o:this.provider().get(e,t),this.start(e,t),i},reset:function(){var e,t,n,i,o;for(e in o=[],i=this.procs)n=i[e],o.push(function(){var e,i,o;for(o=[],e=0,i=n.length;e<i;e++)t=n[e],o.push(t.proc.kill());return o}());return o}},tt=Te(),nt=void 0,it=void 0,ot={};function rt(e){return new Promise((function(t,n){void 0===it?n():it().then((function(i){i=i.toString();var o=ot[i];o?t(e(at(o))):new Promise((function(e,t){nt?nt("Juno requests access to your server configuration to open a terminal.").then((function(t){return e(t)})).catch((function(e){return t(e)})):t("nopackage")})).then((function(n){ot[i]=n,t(e(at(n)))})).catch((function(e){lt(e),n()}))})).catch((function(e){lt(e),n()}))}))}function at(e){if(e&&atom.config.get("julia-client.remoteOptions.agentAuth")){var t=process.env.SSH_AUTH_SOCK||("win32"==process.platform?"pageant":"");!e.agent&&t&&(e.agent=t),e.agentForward||(e.agentForward=atom.config.get("julia-client.remoteOptions.forwardAgent"))}return e}function st(e){return function(){var e=localStorage.juno_remote_server_exec_key;e=null==e?[]:JSON.parse(e);return e}()[e]}function lt(e){if("nopackage"==e)atom.notifications.addInfo("ftp-remote-edit not installed");else if("noservers"==e)var t=atom.notifications.addInfo("Please select a project",{description:"Connect to a server in the ftp-remote-edit tree view.",dismissable:!0,buttons:[{text:"Toggle Remote Tree View",onDidClick:function(){var e=atom.views.getView(atom.workspace);atom.commands.dispatch(e,"ftp-remote-edit:toggle"),t.dismiss()}}]});else atom.notifications.addError("Remote Connection Failed",{details:"Unknown Error: \n\n ".concat(e)})}function ut(e,t){return rt((function(e){st(e.name);return new Promise((function(n,i){Ne.listen().then((function(o){var r=new m.Client;r.on("ready",(function(){r.forwardIn("127.0.0.1",o,(function(e){e&&(atom.notifications.addError("Port in use",{description:"Port ".concat(o," on the remote server already in use.\n                              Try again with another port.")}),i())}));var a=atom.config.get("julia-client.remoteOptions.remoteJulia"),s="";if(atom.config.get("julia-client.remoteOptions.tmux")){var u=atom.config.get("julia-client.remoteOptions.tmuxName");s+="/bin/sh -c '",s+="tmux new -s ".concat(u," '\\''"),void 0!==ct()&&(s+=' JULIA_NUM_THREADS="'.concat(ct(),'" ')),s+=a,s+=" ".concat(t.join(" ")," -e '\\'\\\\\\'\\''"),s+=l.readFileSync(De.script("boot_repl.jl")).toString(),s+="'\\'\\\\\\'\\'' ".concat(o," '\\'' "),s+="|| tmux send-keys -t ".concat(u,".left ^A ^K ^H '\\''Juno.connect(").concat(o,")'\\'' ENTER "),s+="&& tmux attach -t ".concat(u," "),s+="'"}else s+="/bin/sh -c '",void 0!==ct()&&(s+='JULIA_NUM_THREADS="'.concat(ct(),'" ')),s+="".concat(a," ").concat(t.join(" ")," -e '\\''"),s+=l.readFileSync(De.script("boot_repl.jl")).toString(),s+="'\\'' ".concat(o),s+="'";r.exec(s,{pty:{term:"xterm-256color"}},(function(t,i){i.on("close",(function(e){if(e){var t="We tried to launch Julia ";atom.config.get("julia-client.remoteOptions.tmux")&&(t+="in a `tmux` session named `".concat(atom.config.get("julia-client.remoteOptions.tmuxName"),"` ")),t+="from `".concat(a,"` but the process failed with `").concat(e,"`.\n\n"),t+="Please make sure your settings are correct.",atom.notifications.addError("Remote Julia session could not be started.",{description:t,dismissable:!0})}r.end()})),i.on("error",(function(){r.end()})),i.on("finish",(function(){r.end()}));var o=dt(i);i.resize=function(e,t){return i.setWindow(t,e,999,999)},n({ty:i,kill:function(){return i.signal("KILL")},disconnect:function(){return i.close()},interrupt:function(){return i.write("")},socket:o,onExit:function(e){return i.on("close",e)},onStderr:function(e){return i.stderr.on("data",(function(t){return e(t.toString())}))},onStdout:function(e){return i.on("data",(function(t){return e(t.toString())}))},config:e})}))})).on("tcp connection",(function(e,t,n){var i=t();i.on("close",(function(){r.end()})),i.on("error",(function(){r.end()})),i.on("finish",(function(){r.end()}));var a=c.createConnection({port:o},(function(){i.pipe(a).pipe(i)}));a.on("close",(function(){r.end()})),a.on("error",(function(){r.end()})),a.on("finish",(function(){r.end()}))})).connect(e)})).catch((function(e){var t="The following error occured when trying to open a tcp ";t+="connection: ",t+="`".concat(e,"`"),atom.notifications.addError("Error while connecting to remote Julia session.",{description:t,dismissable:!0}),i()}))}))}))}function ct(){var e=atom.config.get("julia-client.juliaOptions.numberOfThreads"),t=parseInt(e);return 0!=t&&isFinite(t)?t:void 0}function dt(e){return conn=Ne.next(),failure=new Promise((function(t,n){e.on("close",(function(e){conn.dispose(),n(e)}))})),Promise.race([conn,failure])}var ft,pt,mt,ht,gt,vt,bt,wt=Object.freeze({__proto__:null,lock:tt,get:function(e,t){return tt((function(n){var i=ut(e,t);return n(i.then((function(e){return e.socket}))),i.catch((function(){return n()})),i}))},withRemoteConfig:rt,consumeGetServerConfig:function(e){nt=e},consumeGetServerName:function(e){it=e},get_:ut});({paths:vt}=Oe),gt=qe,ht=(pt=_e).import("junorc",!1),mt=et,bt=wt,ft=Qe;var yt,kt,jt={consumeGetServerConfig:function(e){return bt.consumeGetServerConfig(e)},consumeGetServerName:function(e){return bt.consumeGetServerName(e)},provider:function(e){switch(void 0,null!=e?e:atom.config.get("julia-client.juliaOptions.bootMode")){case"Cycler":return mt;case"Remote":return bt;case"Basic":return ft}},activate:function(){return"win32"===process.platform?process.env.JULIA_EDITOR=`"${process.execPath}" ${atom.devMode?"-d":""} -a`:process.env.JULIA_EDITOR=`atom ${atom.devMode?"-d":""} -a`,vt.getVersion().then(()=>{var e;return"function"==typeof(e=this.provider()).start?e.start(vt.jlpath(),pt.clargs()):void 0}).catch((function(){}))},monitor:function(e){return pt.emitter.emit("boot",e),e.ready=function(){return!1},pt.attach(e),e},connect:function(e,t){return e.message=function(e){return t.write(JSON.stringify(e))},pt.readStream(t),t.on("end",(function(){return e.kill(),pt.detach()})),t.on("error",(function(){return e.kill(),pt.detach()})),e.ready=function(){return!0},pt.flush(),e},start:function(e){var t,n,i,o;return[i,t]=[vt.jlpath(),pt.clargs()],n=vt.getVersion(),"Remote"===e?n=Promise.resolve():n.catch(e=>gt.jlNotFound(vt.jlpath(),e)),o=n.then(()=>this.spawnJulia(i,t,e)).then(e=>this.monitor(e)),"Remote"===e?bt.withRemoteConfig((function(e){return ht(e.remote)})).catch((function(){})):vt.projectDir().then((function(e){return ht(e)})),o.then(e=>Promise.all([e,e.socket])).then(([e,t])=>this.connect(e,t)).catch((function(e){pt.detach()})),o},spawnJulia:function(e,t,n){return this.provider(n).get(e,t)}};({time:kt}=Oe),yt=We;var Pt,xt,St={IPC:Le,messages:qe,client:_e,local:jt,terminal:We,activate:function(){return this.messages.activate(),this.client.activate(),this.client.boot=()=>this.boot(),this.local.activate(),this.booting=!1},deactivate:function(){return this.client.deactivate()},consumeInk:function(e){return this.IPC.consumeInk(e),this.ink=e},consumeGetServerConfig:function(e){return this.local.consumeGetServerConfig(e)},consumeGetServerName:function(e){return this.local.consumeGetServerName(e)},_boot:function(e){var t;if(!this.client.isActive()&&!this.booting)return this.booting=!0,this.client.setBootMode(e),t="External Terminal"===e?yt.connectedRepl():this.local.start(e),null!=this.ink&&this.ink.Opener.allowRemoteFiles("Remote"===e),t.then(()=>this.booting=!1),t.catch(()=>this.booting=!1),kt("Julia Boot",this.client.import("ping")())},bootRemote:function(){return this._boot("Remote")},boot:function(){return this._boot(atom.config.get("julia-client.juliaOptions.bootMode"))}},Ct=St.client;({terminal:xt}=St),Pt={juliaPath:{type:"string",default:"julia",description:"The location of the Julia binary.",order:1},juliaOptions:{type:"object",order:2,collapsed:!0,properties:{bootMode:{title:"Boot Mode",type:"string",description:"`Basic` spins up a local Julia process on demand and is the most robust option. The `Cycler` will keep a few local Julia processes around at all times to reduce downtime when a process exits. `External Terminal` opens an external terminal and connects it to Juno, much like the `Julia Client: Connect Terminal` command. `Remote` is similar to the `Julia Client: Start Remote Julia Process` command but changes the default, so that evaluating a line in the editor or pressing `Enter` in the REPL tab will start a remote Julia process instead of a local one.",enum:["Basic","Cycler","External Terminal","Remote"],default:"Basic",radio:!0,order:1},optimisationLevel:{title:"Optimisation Level",description:"Higher levels take longer to compile, but produce faster code.",type:"integer",enum:[0,1,2,3],default:2,radio:!0,order:2},deprecationWarnings:{title:"Deprecation Warnings",type:"boolean",description:"If disabled, hides deprecation warnings.",default:!0,order:3},numberOfThreads:{title:"Number of Threads",type:"string",description:"`global` will use global setting, `auto` sets it to number of cores.",default:"auto",order:4},startupArguments:{title:"Additional Julia Startup Arguments",type:"array",description:"`-i`, `-O`, and `--depwarn` will be set by the above options automatically, but can be overwritten here. Arguments are comma-separated, and you should never need to quote anything (even e.g. paths with spaces in them).",default:[],items:{type:"string"},order:5},externalProcessPort:{title:"Port for Communicating with the Julia Process",type:"string",description:"`random` will use a new port each time, or enter an integer to set the port statically.",default:"random",order:6},arguments:{title:"Arguments",type:"array",description:"Set `ARGS` to the following entries (comma-separated). Requires restart of Julia process.",default:[],items:{type:"string"},order:7},persistWorkingDir:{title:"Persist Working Directory",type:"boolean",default:!1,order:8},workingDir:{title:"Working Directory",type:"string",default:"",order:9},fuzzyCompletionMode:{title:"Fuzzy Completion Mode",description:"If `true`, in-editor auto-completions are generated based on fuzzy (i.e. more permissive) matches,\notherwise based on strict matches as in REPL.\n***NOTE***: this setting doesn't affect completions in REPL,\nand so in-REPL completions will still work as usual (i.e. based on strict matches and will complete eagerly).",type:"boolean",default:!0,order:10},autoCompletionSuggestionPriority:{title:"Auto-Completion Suggestion Priority",description:"Specify the sort order of auto-completion suggestions provided by Juno.\nNote the default providers like snippets have priority of `1`.\nRequires Atom restart to take an effect.",type:"integer",default:3,order:11},noAutoParenthesis:{title:"Don't Insert Parenthesis on Function Auto-completion",description:"If enabled, Juno will not insert parenthesis after completing a function.",type:"boolean",default:!1,order:12},formatOnSave:{title:"Format the current editor when saving",description:"If enabled, Juno will format the current editor on save if a Julia session is running.",type:"boolean",default:!1,order:13},formattingOptions:{title:"Formatting Options",description:'⚠ This config is deprecated. In order to specify\n[Formatting Options](https://domluna.github.io/JuliaFormatter.jl/dev/#Formatting-Options-1),\nuse `.JuliaFormatter.toml` configuration file instead.\nSee the ["Configuration File" section](https://domluna.github.io/JuliaFormatter.jl/stable/config/)\nin JuliaFormatter.jl\'s documentation for more details.',type:"object",order:14,collapsed:!0,properties:{mock:{title:"mock (doesn't have any effect)",type:"boolean",default:!1}}}}},uiOptions:{title:"UI Options",type:"object",order:3,collapsed:!0,properties:{resultsDisplayMode:{title:"Result Display Mode",type:"string",default:"inline",enum:[{value:"inline",description:"Float results next to code"},{value:"block",description:"Display results under code"},{value:"console",description:"Display results in the REPL"}],order:1},scrollToResult:{title:"Scroll to Inline Results",type:"boolean",default:!1,order:2},docsDisplayMode:{title:"Documentation Display Mode",type:"string",default:"pane",enum:[{value:"inline",description:"Show documentation in the editor"},{value:"pane",description:"Show documentation in the documentation pane"}],order:3},errorNotifications:{title:"Error Notifications",type:"boolean",default:!0,description:"When evaluating a script, show errors in a notification as well as in the REPL.",order:4},errorInRepl:{title:"Show Errors in REPL (Inline Evaluation)",type:"boolean",default:!1,description:"If enabled, Juno always shows errors in the REPL when using inline evaluation.",order:5},enableMenu:{title:"Enable Menu",type:"boolean",default:!1,description:"Show a Julia menu in the menu bar (requires restart).",order:6},enableToolBar:{title:"Enable Toolbar",type:"boolean",default:!1,description:"Show Julia icons in the tool bar (requires restart).",order:7},usePlotPane:{title:"Enable Plot Pane",type:"boolean",default:!0,description:"Show plots in Atom.",order:8},maxNumberPlots:{title:"Maximum Number of Plots in History",type:"number",default:50,description:"Increasing this number may lead to high memory consumption and poor performance.",order:9},openNewEditorWhenDebugging:{title:"Open New Editor When Debugging",type:"boolean",default:!1,description:"Opens a new editor tab when stepping into a new file instead of reusing the current one (requires restart).",order:10},cellDelimiter:{title:"Cell Delimiter",type:"array",default:["##\\s","#---","#\\s?%%"],description:"Regular expressions for determining cell delimiters.",order:11},highlightCells:{title:"Highlight Cells",type:"boolean",description:"Customize the appearence of Juno's cell highlighting by adding styles for `.line.julia-current-cell` or `.line-number.julia-current-cell` to your personal stylesheet.",default:!0,order:12},layouts:{title:"Layout Options",type:"object",order:13,collapsed:!0,properties:{console:{title:"REPL",type:"object",order:1,collapsed:!0,properties:{defaultLocation:{title:"Default location of REPL Pane",type:"string",enum:["center","left","bottom","right"],default:"bottom",radio:!0,order:1},split:{title:"Splitting rule of REPL Pane",type:"string",enum:["no split","left","up","right","down"],default:"no split",radio:!0,order:2}}},terminal:{title:"Terminal",type:"object",order:2,collapsed:!0,properties:{defaultLocation:{title:"Default location of Terminal Pane",type:"string",enum:["center","left","bottom","right"],default:"bottom",radio:!0,order:1},split:{title:"Splitting rule of Terminal Pane",type:"string",enum:["no split","left","up","right","down"],default:"no split",radio:!0,order:2}}},workspace:{title:"Workspace",type:"object",order:3,collapsed:!0,properties:{defaultLocation:{title:"Default location of Workspace Pane",type:"string",enum:["center","left","bottom","right"],default:"center",radio:!0,order:1},split:{title:"Splitting rule of Workspace Pane",type:"string",enum:["no split","left","up","right","down"],default:"right",radio:!0,order:2}}},documentation:{title:"Documentation Browser",type:"object",order:4,collapsed:!0,properties:{defaultLocation:{title:"Default location of Documentation Browser Pane",type:"string",enum:["center","left","bottom","right"],default:"center",radio:!0,order:1},split:{title:"Splitting rule of Documentation Browser Pane",type:"string",enum:["no split","left","up","right","down"],default:"right",radio:!0,order:2}}},plotPane:{title:"Plot Pane",type:"object",order:5,collapsed:!0,properties:{defaultLocation:{title:"Default location of Plot Pane",type:"string",enum:["center","left","bottom","right"],default:"center",radio:!0,order:1},split:{title:"Splitting rule of Plot Pane",type:"string",enum:["no split","left","up","right","down"],default:"right",radio:!0,order:2}}},debuggerPane:{title:"Debugger Pane",type:"object",order:6,collapsed:!0,properties:{defaultLocation:{title:"Default location of Debugger Pane",type:"string",enum:["center","left","bottom","right"],default:"right",radio:!0,order:1},split:{title:"Splitting rule of Debugger Pane",type:"string",enum:["no split","left","up","right","down"],default:"no split",radio:!0,order:2}}},profiler:{title:"Profiler",type:"object",order:7,collapsed:!0,properties:{defaultLocation:{title:"Default location of Profiler Pane",type:"string",enum:["center","left","bottom","right"],default:"center",radio:!0,order:1},split:{title:"Splitting rule of Profiler Pane",type:"string",enum:["no split","left","up","right","down"],default:"right",radio:!0,order:2}}},linter:{title:"Linter",type:"object",order:8,collapsed:!0,properties:{defaultLocation:{title:"Default location of Linter Pane",type:"string",enum:["center","left","bottom","right"],default:"bottom",radio:!0,order:1},split:{title:"Splitting rule of Linter Pane",type:"string",enum:["no split","left","up","right","down"],default:"no split",radio:!0,order:2}}},outline:{title:"Outline",type:"object",order:9,collapsed:!0,properties:{defaultLocation:{title:"Default location of Outline Pane",type:"string",enum:["center","left","bottom","right"],default:"left",radio:!0,order:1},split:{title:"Splitting rule of Outline Pane",type:"string",enum:["no split","left","up","right","down"],default:"down",radio:!0,order:2}}},defaultPanes:{title:"Default Panes",description:"Specify panes that are opened by `Julia Client: Restore Default Layout`. The location and splitting rule of each pane follow the settings above.",type:"object",order:10,properties:{console:{title:"REPL",type:"boolean",default:!0,order:1},workspace:{title:"Workspace",type:"boolean",default:!0,order:2},documentation:{title:"Documentation Browser",type:"boolean",default:!0,order:3},plotPane:{title:"Plot Pane",type:"boolean",default:!0,order:4},debuggerPane:{title:"Debugger Pane",type:"boolean",default:!1,order:5},linter:{title:"Linter",type:"boolean",default:!1,order:6},outline:{title:"Outline",type:"boolean",default:!1,order:7}}},openDefaultPanesOnStartUp:{title:"Open Default Panes on Startup",description:"If enabled, opens panes specified above on startup. Note a layout deserialized from a previous window state would be modified by that, i.e.: disable this if you want to keep the deserialized layout.",type:"boolean",default:!0,order:11}}}}},consoleOptions:{type:"object",title:"Terminal Options",order:4,collapsed:!0,properties:{maximumConsoleSize:{title:"Scrollback Buffer Size",type:"integer",default:1e4,order:1},prompt:{title:"Terminal Prompt",type:"string",default:"julia>",order:2},shell:{title:"Shell",type:"string",default:xt.defaultShell(),description:"The location of an executable shell. Set to `$SHELL` by default, and if `$SHELL` isn't set then fallback to `bash` or `powershell.exe` (on Windows).",order:3},terminal:{title:"Terminal",type:"string",default:xt.defaultTerminal(),description:"Command used to open an external terminal.",order:4},whitelistedKeybindingsREPL:{title:"Whitelisted Keybindings for the Julia REPL",type:"array",default:["Ctrl-C","F5","F8","F9","F10","F11","Shift-F5","Shift-F8","Shift-F9","Shift-F10","Shift-F11"],description:"The listed keybindings are not handled by the REPL and instead directly passed to Atom.",order:5},whitelistedKeybindingsTerminal:{title:"Whitelisted Keybindings for Terminals",type:"array",default:[],description:"The listed keybindings are not handled by any terminals and instead directly passed to Atom.",order:6},cursorStyle:{title:"Cursor Style",type:"string",enum:["block","underline","bar"],default:"block",radio:!0,order:7},cursorBlink:{title:"Cursor Blink",type:"boolean",default:!1,order:8},terminalRendererType:{title:"Terminal Renderer",type:"string",enum:["webgl","canvas","dom"],default:"webgl",radio:!0,description:"The `webgl` renderer is fastest, but is still experimental. `canvas` performs well in many cases, while `dom` is a slow falback. Note that it's not possible to hot-swap to the `webgl` renderer.",order:9},linkModifier:{title:"Ctrl/Cmd modifier for link activation",type:"boolean",default:!0,order:10}}},remoteOptions:{type:"object",order:5,collapsed:!0,properties:{remoteJulia:{title:"Command to execute Julia on the remote server",type:"string",default:"julia",order:1},tmux:{title:"Use a persistent tmux session",description:"Requires tmux to be installed on the server you're connecting to.",type:"boolean",default:!1,order:2},tmuxName:{title:"tmux session name",type:"string",default:"juno_tmux_session",order:3},agentAuth:{title:"Use SSH agent",description:"Requires `$SSH_AUTH_SOCKET` to be set. Defaults to putty's pageant on Windows.",type:"boolean",default:!0,order:4},forwardAgent:{title:"Forward SSH agent",type:"boolean",default:!0,order:5}}},juliaSyntaxScopes:{title:"Julia Syntax Scopes",description:"The listed syntax scopes (comma separated) will be recoginized as Julia files. You may have to restart Atom to take an effect.\n **DO NOT** edit this unless you're sure about the effect.",type:"array",default:["source.julia","source.weave.md","source.weave.latex"],order:6},disableProxy:{title:"Disable System Proxy for Child Processes",description:"This unsets the `HTTP_PROXY` and `HTTPS_PROXY` environment variables in all integrated terminals. Try this option if you're experiencing issues when installing Julia packages in Juno.",type:"boolean",default:!1,order:7},firstBoot:{type:"boolean",default:!0,order:99}},"darwin"!==process.platform&&(Pt.consoleOptions.properties.whitelistedKeybindingsREPL.default=["Ctrl-C","Ctrl-J","Ctrl-K","Ctrl-E","Ctrl-V","Ctrl-M","F5","F8","F9","F10","F11","Shift-F5","Shift-F8","Shift-F9","Shift-F10","Shift-F11"]),"darwin"===process.platform&&(Pt.consoleOptions.properties.macOptionIsMeta={title:"Use Option as Meta",type:"boolean",default:!1,order:5.5});var Ot,Dt=Pt;({CompositeDisposable:Ot}=o);var Et={activate:function(){var e;if(this.subs=new Ot,this.subs.add(atom.menu.add([{label:"Packages",submenu:this.menu}])),atom.config.get("julia-client.uiOptions.enableMenu"))return this.subs.add=atom.menu.add(this.menu),e=atom.menu.template.pop(),atom.menu.template.splice(3,0,e)},deactivate:function(){return this.subs.dispose()},menu:[{label:"Juno",submenu:[{label:"Start Julia",command:"julia-client:start-julia"},{label:"Start Remote Julia Process",command:"julia-client:start-remote-julia-process"},{label:"Interrupt Julia",command:"julia-client:interrupt-julia"},{label:"Stop Julia",command:"julia-client:kill-julia"},{type:"separator"},{label:"Open REPL",command:"julia-client:open-REPL"},{label:"Clear REPL",command:"julia-client:clear-REPL"},{label:"Open External REPL",command:"julia-client:open-external-REPL"},{label:"Working Directory",submenu:[{label:"Current File's Folder",command:"julia-client:work-in-current-folder"},{label:"Select Project Folder",command:"julia-client:work-in-project-folder"},{label:"Home Folder",command:"julia-client:work-in-home-folder"},{label:"Select...",command:"julia-client:select-working-folder"}]},{label:"Environment",submenu:[{label:"Environment in Current File's Folder",command:"julia-client:activate-environment-in-current-folder"},{label:"Environment in Parent Folder",command:"julia-client:activate-environment-in-parent-folder"},{label:"Default Environment",command:"julia-client:activate-default-environment"}]},{label:"Set Working Module",command:"julia-client:set-working-module"},{type:"separator"},{label:"Run Block",command:"julia-client:run-block"},{label:"Run All",command:"julia-client:run-all"},{type:"separator"},{label:"Format Code",command:"julia-client:format-code"},{type:"separator"},{label:"Debug: Run Block",command:"julia-debug:run-block"},{label:"Debug: Step through Block",command:"julia-debug:step-through-block"},{label:"Debug: Run File",command:"julia-debug:run-file"},{label:"Debug: Step through File",command:"julia-debug:step-through-file"},{type:"separator"},{label:"Open Workspace",command:"julia-client:open-workspace"},{label:"Open Outline Pane",command:"julia-client:open-outline-pane"},{label:"Open Documentation Browser",command:"julia-client:open-documentation-browser"},{label:"Open Plot Pane",command:"julia-client:open-plot-pane"},{label:"Open Debugger Pane",command:"julia-debug:open-debugger-pane"},{type:"separator"},{label:"Open New Julia File",command:"julia:new-julia-file"},{label:"Open Julia Startup File",command:"julia:open-julia-startup-file"},{label:"Open Juno Startup File",command:"julia:open-juno-startup-file"},{label:"Open Julia Home",command:"julia:open-julia-home"},{label:"Open Package in New Window...",command:"julia:open-package-in-new-window"},{label:"Open Package as Project Folder...",command:"julia:open-package-as-project-folder"},{type:"separator"},{label:"New Terminal",submenu:[{label:"Current File's Folder",command:"julia-client:new-terminal-from-current-folder"},{label:"Select Project Folder",command:"julia-client:new-terminal"}]},{label:"New Remote Terminal",command:"julia-client:new-remote-terminal"},{type:"separator"},{label:"Debug Information",command:"julia-client:debug-info"},{label:"Help...",command:"julia:get-help"},{label:"Settings...",command:"julia-client:settings"}]}]},It=Dt,Tt=[];function Rt(){It=null,Tt=null}var Lt,At,Bt,_t=Object.freeze({__proto__:null,updateSettings:function(){if(function e(t,n){Object.entries(t).forEach((function(t){var i=O(t,2),o=i[0],r=i[1];if("[object Object]"===Object.prototype.toString.call(r)){var a=n.slice(0);a.push(o),e(r,a)}var s=It;if(n.forEach((function(e){Object.entries(s).forEach((function(t){var n=O(t,2),i=n[0],o=n[1];i===e?s=o:"properties"===i&&o[e]&&(s=o[e])}))})),!(s[o]||s.properties&&s.properties[o])){var l="julia-client.";l+=0===n.length?"":"".concat(n.join("."),"."),l+=o,Tt.push(l)}}))}(atom.config.get("julia-client"),[]),Tt.length>0)var e=atom.notifications.addWarning("Julia-Client: Invalid (deprecated) settings found",{detail:Tt.join("\n"),dismissable:!0,description:"Remove these invalid settings ?",buttons:[{text:"Yes",onDidClick:function(){e.dismiss(),Tt.forEach((function(e){atom.config.unset(e)})),Rt()}},{text:"No",onDidClick:function(){e.dismiss(),Rt()}}]})}}),Mt={consumeToolBar:function(e){if(atom.config.get("julia-client.uiOptions.enableToolBar"))return this.bar=e("julia-client"),this.bar.addButton({icon:"file-code",iconset:"fa",tooltip:"New Julia File",callback:"julia:new-julia-file"}),this.bar.addButton({icon:"save",iconset:"fa",tooltip:"Save",callback:"core:save"}),this.bar.addButton({icon:"folder-open",iconset:"fa",tooltip:"Open File...",callback:"application:open-file"}),this.bar.addSpacer(),this.bar.addButton({icon:"globe",tooltip:"Start Local Julia Process",callback:"julia-client:start-julia"}),this.bar.addButton({iconset:"ion",icon:"md-planet",tooltip:"Start Remote Julia Process",callback:"julia-client:start-remote-julia-process"}),this.bar.addButton({icon:"md-pause",iconset:"ion",tooltip:"Interrupt Julia",callback:"julia-client:interrupt-julia"}),this.bar.addButton({icon:"md-square",iconset:"ion",tooltip:"Stop Julia",callback:"julia-client:kill-julia"}),this.bar.addSpacer(),this.bar.addButton({icon:"zap",tooltip:"Run Block",callback:"julia-client:run-and-move"}),this.bar.addButton({icon:"md-play",iconset:"ion",tooltip:"Run All",callback:"julia-client:run-all"}),this.bar.addButton({icon:"format-float-none",iconset:"mdi",tooltip:"Format Code",callback:"julia-client:format-code"}),this.bar.addSpacer(),this.bar.addButton({icon:"terminal",tooltip:"Show REPL",callback:"julia-client:open-REPL"}),this.bar.addButton({icon:"book",tooltip:"Show Workspace",callback:"julia-client:open-workspace"}),this.bar.addButton({icon:"list-unordered",tooltip:"Show Outline",callback:"julia-client:open-outline-pane"}),this.bar.addButton({icon:"info",tooltip:"Show Documentation Browser",callback:"julia-client:open-documentation-browser"}),this.bar.addButton({icon:"graph",tooltip:"Show Plot Pane",callback:"julia-client:open-plot-pane"}),this.bar.addButton({icon:"bug",tooltip:"Show Debugger Pane",callback:"julia-debug:open-debugger-pane"})},deactivate:function(){var e;return null!=(e=this.bar)?e.removeItems():void 0}},Ft={activate:function(){},enabled:function(){return atom.config.get("julia-client.uiOptions.notifications")},show:function(e,t){}};function Jt(e,t){var n=t.selected,i=document.createElement("li");n&&i.classList.add("active");var o=e.primary?e.primary.toString():e.toString(),r=Bt.matchHighlighter.highlightMatches(o,Lt.getFilterQuery());if(i.appendChild(r),e.secondary){var a=document.createElement("div");a.classList.add("secondary-line","path"),a.innerText=e.secondary,i.classList.add("two-lines"),r.classList.add("primary-line"),i.append(a)}return i}function zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.active,i=t.emptyMessage,o=t.errorMessage,r=t.infoMessage,a=t.allowCustom;Lt.update({items:[],query:"",loadingMessage:"Loading ..."});var s=atom.workspace.getActivePane();At.show(),Lt.focus();var l=!1;return new Promise((function(t,u){if(Lt.props.didConfirmSelection=function(e){l=!0,Lt.cancelSelection(),t(e)},Lt.props.didConfirmEmptySelection=function(){l=!0,Lt.cancelSelection();var e=Lt.getQuery();a&&e.length>0?t(e):t()},Lt.props.didCancelSelection=function(){At.hide(),s.activate();var e=Lt.getQuery();l||(a&&e.length>0?t(e):t())},Lt.props.filterKeyForItem=e.length>0&&e[0]instanceof Object?function(e){return e.primary}:function(e){return e},e.constructor==Promise)e.then((function(e){if(Lt.update({items:e,emptyMessage:i,errorMessage:o,infoMessage:r,loadingMessage:""}),n){var t=n instanceof Number?n:n instanceof Function?e.findIndex(n):e.findIndex((function(e){return e==n}));Lt.selectIndex(t)}})).catch((function(e){u(e),Lt.cancelSelection()}));else if(Lt.update({items:e,emptyMessage:i,errorMessage:o,infoMessage:r,loadingMessage:""}),n){var c=n instanceof Number?n:n instanceof Function?e.findIndex(n):e.findIndex((function(e){return e==n}));Lt.selectIndex(c)}}))}var Nt,Ht,Vt,Wt,qt,Ut,$t=Object.freeze({__proto__:null,activate:function(e){Bt=e,(Lt=new g({items:[],elementForItem:Jt})).element.classList.add("command-palette","julia-client-selector"),At=atom.workspace.addModalPanel({item:Lt.element})},show:zt});Nt=a,Ht={highlight:function(e,t,{scopePrefix:n,block:i}={}){var o,r,a,s,l,u,c,d,f,p,m;for(null==n&&(n=""),null==i&&(i=!1),(c=t.tokenizeLines(e)).length>0&&1===(s=c[c.length-1]).length&&""===s[0].value&&c.pop(),o='<code class="editor editor-colors">',r=0,l=c.length;r<l;r++){for(d=[],o+=`<${i?"div":"span"} class="line">`,a=0,u=(p=c[r]).length;a<u;a++)({value:m,scopes:f}=p[a]),m||(m=" "),o=this.updateScopeStack(d,f,o,n),o+=`<span>${this.escapeString(m)}</span>`;for(;d.length>0;)o=this.popScope(d,o);o+=`</${i?"div":"span"}>`}return o+="</code>"},escapeString:function(e){return e.replace(/[&"'<> ]/g,(function(e){switch(e){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";case" ":return"&nbsp;";default:return e}}))},updateScopeStack:function(e,t,n,i){var o,r,a,s,l,u,c,d;if((o=e.length-t.length)>0)for(;o--;)n=this.popScope(e,n);for(r=s=u=e.length;(u<=0?s<=0:s>=0)&&!Nt.isEqual(e.slice(0,r),t.slice(0,r));r=u<=0?++s:--s)n=this.popScope(e,n);for(a=l=c=r,d=t.length;c<=d?l<d:l>d;a=c<=d?++l:--l)n=this.pushScope(e,t[a],n,i);return n},pushScope:function(e,t,n,i){return e.push(t),n+`<span class="${i+t.replace(/\.+/g," "+i)}">`},popScope:function(e,t){return e.pop(),t+"</span>"}},({client:Vt}=St),({once:qt}=Oe),Wt=Vt.import("getlazy");var Gt,Kt,Yt,Zt=Ut={dom:function({tag:e,attrs:t,contents:n},i){var o,r,a,s,l,u;for(a in u=document.createElement(e),t)(l=t[a])instanceof Array&&(l=l.join(" ")),u.setAttribute(a,l);if(null!=n)for(n.constructor!==Array&&(n=[n]),r=0,s=n.length;r<s;r++)o=n[r],u.appendChild(this.render(o,i));return u},html:function({content:e,block:t=!1}){var n;return(n=this.render(t?this.tags.div():this.tags.span())).innerHTML=e,1===n.children.length?n.children[0]:n},tree:function({head:e,children:t,expand:n},i){return this.ink.tree.treeView(this.render(e,i),t.map(e=>this.render(this.tags.div([e]),i)),{expand:n})},lazy:function({head:e,id:t},n){var i,o;return i=Vt.conn,null!=n.registerLazy&&n.registerLazy(t),o=this.ink.tree.treeView(this.render(e,n),[],{onToggle:qt(()=>{if(Vt.conn===i)return Wt(t).then(e=>{var t;return t=o.querySelector(":scope > .body"),e.map(e=>this.render(this.tags.div([e]),n)).forEach(e=>t.appendChild(this.ink.ansiToHTML(e)))})})})},subtree:function({label:e,child:t},n){return this.render("tree"===t.type?{type:"tree",head:this.tags.span([e,t.head]),children:t.children}:this.tags.span("gutted",[e,t]),n)},copy:function({view:e,text:t},n){return e=this.render(e,n),atom.commands.add(e,{"core:copy":function(e){return atom.clipboard.write(t),e.stopPropagation()}}),e},link:function({file:e,line:t,contents:n}){var i,o;return o=this.render(this.tags.a({href:"#"},n)),i=this.ink.Opener.isUntitled(e)?atom.tooltips.add(o,{title:function(){return"untitled"}}):atom.tooltips.add(o,{title:function(){return e}}),o.onclick=n=>(this.ink.Opener.open(e,t,{pending:atom.config.get("core.allowPendingPaneItems")}),n.stopPropagation()),o.addEventListener("DOMNodeRemovedFromDocument",()=>i.dispose()),o},number:function({value:e,full:t}){var n,i,o;return(i=e.toPrecision(3)).toString().length>=t.length||(i+="…"),o=this.render(this.tags.span("syntax--constant syntax--numeric",i)),n=!1,o.onclick=function(e){return o.innerText=n?i:t,n=!n,e.stopPropagation()},o},code:function({text:e,attrs:t,scope:n}){var i,o,r;return o=atom.grammars.grammarForScopeName("source.julia"),i=(null!=t?t.block:void 0)||!1,r=Ht.highlight(e,o,{scopePrefix:"syntax--",block:i}),this.render({type:"html",block:i,content:r})},latex:function({attrs:e,text:t}){var n,i;return n=(null!=e?e.block:void 0)||!1,i=this.ink.KaTeX.texify(t,n),this.render({type:"html",block:n,content:i})},views:{dom:function(...e){return Ut.dom(...e)},html:function(...e){return Ut.html(...e)},tree:function(...e){return Ut.tree(...e)},lazy:function(...e){return Ut.lazy(...e)},subtree:function(...e){return Ut.subtree(...e)},link:function(...e){return Ut.link(...e)},copy:function(...e){return Ut.copy(...e)},number:function(...e){return Ut.number(...e)},code:function(...e){return Ut.code(...e)},latex:function(...e){return Ut.latex(...e)}},render:function(e,t={}){var n;return this.views.hasOwnProperty(e.type)?(n=this.views[e.type](e,t),this.ink.ansiToHTML(n),n):(null!=e?e.constructor:void 0)===String?new Text(e):this.render("julia-client: can't render "+(null!=e?e.type:void 0))},tag:function(e,t,n){return(null!=t?t.constructor:void 0)===String&&(t={class:t}),(null!=t?t.constructor:void 0)!==Object&&([n,t]=[t,void 0]),{type:"dom",tag:e,attrs:t,contents:n}},tags:{}};["div","span","a","strong","table","tr","td","webview"].forEach((function(e){return Ut.tags[e]=function(t,n){return Ut.tag(e,t,n)}})),({CompositeDisposable:Gt}=o),({client:Kt}=St),({formatTimePeriod:Yt}=Oe);var Xt,Qt,en,tn,nn,on,rn,an,sn,ln={progs:{},activate:function(){var e;return this.subs=new Gt,Kt.handle({progress:(e,t,n)=>this[e](t,n)}),e=[],this.subs.add(Kt.onWorking(()=>{var t;return e=null!=(t=this.ink)?t.progress.add(null,{description:"Julia"}):void 0})),this.subs.add(Kt.onDone(()=>null!=e?e.destroy():void 0)),this.subs.add(Kt.onDetached(()=>this.clear()))},deactivate:function(){return this.clear(),this.subs.dispose()},add:function(e){var t;return(t=this.ink.progress.add()).t0=Date.now(),t.showTime=!0,this.progs[e]=t},progress:function(e,t){var n;if(null!=(n=this.progs[e]))return n.level=t,n.showTime?this.rightText(e,null):void 0},message:function(e,t){var n;return null!=(n=this.progs[e])?n.message=t:void 0},leftText:function(e,t){var n;return null!=(n=this.progs[e])?n.description=t:void 0},rightText:function(e,t){var n,i;if(null!=(i=this.progs[e]))return(null!=t?t.length:void 0)?(i.rightText=t,i.showTime=!1):(n=(Date.now()-i.t0)*(1/i.level-1)/1e3,i.showTime=!0,i.rightText=Yt(n))},delete:function(e){var t;if(null!=(t=this.progs[e]))return t.destroy(),delete this.progs[e]},clear:function(){var e,t,n;for(e in n=this.progs)null!=(t=n[e])&&t.destroy();return this.progs={}}};({CompositeDisposable:Xt,Disposable:Qt,Emitter:en}=o),({debounce:on}=a),({client:nn}=St),({show:sn}=$t),({module:rn,allmodules:tn,ismodule:an}=nn.import(["module","allmodules","ismodule"]));var un,cn,dn={activate:function(){return this.subs=new Xt,this.itemSubs=new Xt,this.subs.add(this.emitter=new en),this.subs.add(atom.workspace.observeActivePaneItem(e=>this.updateForItem(e))),this.subs.add(nn.onAttached(()=>this.updateForItem())),this.subs.add(nn.onDetached(()=>this.updateForItem()))},deactivate:function(){return this.subs.dispose()},_current:null,lastEditorModule:null,setCurrent:function(e,t){return this._current=e,t&&(this.lastEditorModule=this._current),this.emitter.emit("did-change",this._current)},onDidChange:function(e){return this.emitter.on("did-change",e)},current:function(e=this._current){var t,n,i,o;if(null!=e)return({main:n,inactive:t,sub:i,subInactive:o}=e),n===this.follow?this.current(this.lastEditorModule):!n||t?"Main":!i||o?n:`${n}.${i}`},itemSelector:'atom-text-editor[data-grammar="source julia"], .julia-console.julia, ink-terminal, .ink-workspace',isValidItem:function(e){var t;return null!=(t=atom.views.getView(e))?t.matches(this.itemSelector):void 0},autodetect:"Auto Detect",follow:"Follow Editor",chooseModule:function(){var e,t;if(t=atom.workspace.getActivePaneItem(),e=atom.workspace.isTextEditor(t),this.isValidItem(t))return nn.require("change modules",()=>{var n,i;if(t=atom.workspace.getActivePaneItem())return n=t.juliaModule||(e?this.autodetect:"Main"),(i=tn().then(t=>(e?t.unshift(this.autodetect):null!=this.lastEditorModule&&t.unshift(this.follow),t))).catch(e=>{}),sn(i,{active:n}).then(e=>{if(null!=e)return e===this.autodetect?delete t.juliaModule:t.juliaModule=e,"function"==typeof t.setModule&&t.setModule(e!==this.autodetect?e:void 0),this.updateForItem(t)})})},updateForItem:function(e=atom.workspace.getActivePaneItem()){var t;return this.itemSubs.dispose(),this.isValidItem(e)?nn.isActive()?atom.workspace.isTextEditor(e)?this.updateForEditor(e):(t=e.juliaModule||"Main",an(t).then(e=>this.setCurrent({main:t,inactive:!e})).catch(e=>{})):this.setCurrent({main:"Main",inactive:!0}):(this.itemSubs.add(null!=e&&"function"==typeof e.onDidChangeGrammar?e.onDidChangeGrammar(()=>this.updateForItem()):void 0),this.setCurrent())},updateForEditor:function(e){return this.setCurrent({main:e.juliaModule||"Main"},!0),this.setEditorModule(e),this.itemSubs.add(e.onDidChangeCursorPosition(()=>this.setEditorModuleLazy(e)))},getEditorModule:function(e,t=null){var n,i,o,r;if(nn.isActive())return t?({row:o,column:n}=t):(r=e.getSelections(),({row:o,column:n}=r[r.length-1].getBufferRange().end)),i={path:nn.editorPath(e),code:e.getText(),row:o+1,column:n+1,module:e.juliaModule},rn(i).catch(e=>{})},setEditorModule:function(e){var t;if(t=this.getEditorModule(e))return t.then(t=>{if(atom.workspace.getActivePaneItem()===e)return this.setCurrent(t,!0)})},setEditorModuleLazy:on((function(e){return this.setEditorModule(e)}),100),activateView:function(){var e,t,n,i,o;for(this.onDidChange(e=>this.updateView(e)),this.dom=document.createElement("span"),this.dom.classList.add("julia","inline-block"),this.mainView=document.createElement("a"),this.dividerView=document.createElement("span"),this.subView=document.createElement("span"),t=0,n=(i=[this.mainView,this.dividerView,this.subView]).length;t<n;t++)o=i[t],this.dom.appendChild(o);return this.mainView.onclick=()=>atom.commands.dispatch(atom.views.getView(atom.workspace.getActivePaneItem()),"julia-client:set-working-module"),atom.tooltips.add(this.dom,{title:()=>"Currently working in module "+this.current()}),this.tile=this.statusBar.addRightTile({item:this.dom,priority:5}),e=new Qt(()=>(this.tile.destroy(),delete this.tile)),this.subs.add(e),e},updateView:function(e){var t,n,i,o,r,a,s,l,u,c,d,f;if(null!=this.tile){if(null==e)return this.dom.style.display="none";if(({main:a,sub:c,inactive:n,subInactive:d}=e),a===this.follow)return this.updateView(this.lastEditorModule);if(this.dom.style.display="",this.mainView.innerText=a||"Main",c)this.subView.innerText=c,this.dividerView.innerText="/";else for(t=0,o=(s=[this.subView,this.dividerView]).length;t<o;t++)(f=s[t]).innerText="";if(n)return this.dom.classList.add("fade");for(this.dom.classList.remove("fade"),u=[],i=0,r=(l=[this.subView,this.dividerView]).length;i<r;i++)f=l[i],d?u.push(f.classList.add("fade")):u.push(f.classList.remove("fade"));return u}},consumeStatusBar:function(e){var t;return this.statusBar=e,t=this.activateView(),this.updateView(this._current),t}},fn=Ct.import(["gotosymbol","regeneratesymbols","clearsymbols"]),pn=fn.gotosymbol,mn=fn.regeneratesymbols,hn=fn.clearsymbols,gn=/(include|include_dependency)\(".+\.jl"\)/,vn=/".+\.jl"/,bn=new(function(){function e(){P(this,e)}return S(e,[{key:"activate",value:function(e){this.ink=e,this.subscriptions=new i.CompositeDisposable,this.subscriptions.add(atom.commands.add("atom-workspace","julia-client:regenerate-symbols-cache",(function(){mn()})),atom.commands.add("atom-workspace","julia-client:clear-symbols-cache",(function(){hn()})))}},{key:"deactivate",value:function(){this.subscriptions.dispose()}},{key:"getJumpFilePath",value:function(e,t){if(ve(e,t,{wordRegex:gn}).isEmpty())return!1;var n=ve(e,t,{wordRegex:vn});if(n.isEmpty())return!1;var i=e.getTextInBufferRange(n).replace(/"/g,""),o=s.dirname(e.getPath()),r=s.join(o,i);return!!l.existsSync(r)&&{range:n,filePath:r}}},{key:"isClientAndInkReady",value:function(){return Ct.isActive()&&void 0!==this.ink}},{key:"selectItemsAndGo",value:function(e){var t=this;if(0!==e.length){if(1===e.length){var n=e[0];return this.ink.Opener.open(n.file,n.line,{pending:atom.config.get("core.allowPendingPaneItems")})}return zt(e=e.map((function(e){return e.primary=e.text,e.secondary="".concat(e.file,":").concat(e.line),e}))).then((function(e){e&&t.ink.Opener.open(e.file,e.line,{pending:atom.config.get("core.allowPendingPaneItems")})}))}}},{key:"gotoSymbol",value:function(){var e=this,t=atom.workspace.getActiveTextEditor(),n=t.getCursorBufferPosition(),i=this.getJumpFilePath(t,n);if(i){var o=i.filePath;return this.ink.Opener.open(o,0,{pending:atom.config.get("core.allowPendingPaneItems")})}if(this.isClientAndInkReady()){var r=ge(t,{bufferPosition:n}),a=r.word,s=r.range;if(s=be(a,s,n),we(a=t.getTextInBufferRange(s))){var l=n.column,u=n.row,c=te(t,u),d=c.context,f=c.startRow,p=dn.current(),m=p||"Main",h=t.getText();return pn({word:a,path:t.getPath()||"untitled-"+t.getBuffer().getId(),column:l+1,row:u+1,startRow:f,context:d,onlyGlobal:!1,mod:m,text:h}).then((function(t){t.error||e.selectItemsAndGo(t.items)})).catch((function(e){}))}}}},{key:"provideHyperclick",value:function(){var e=this,t=function(){var t=j(regeneratorRuntime.mark((function t(n,o){var r,a,s,l,u,c,d,f,p,m,h,g,v,b,w,y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.getJumpFilePath(n,o))){t.next=4;break}return a=r.range,s=r.filePath,t.abrupt("return",{range:a,callback:function(){return e.ink.Opener.open(s,0,{pending:atom.config.get("core.allowPendingPaneItems")})}});case 4:if(e.isClientAndInkReady()){t.next=6;break}return t.abrupt("return");case 6:if(q(n,o)){t.next=8;break}return t.abrupt("return");case 8:if(l=ge(n,{bufferPosition:o}),u=l.word,c=l.range,c=be(u,c,o),we(u=n.getTextInBufferRange(c))){t.next=13;break}return t.abrupt("return");case 13:return d=o.column,f=o.row,p=te(n,f),m=p.context,h=p.startRow,t.next=17,dn.getEditorModule(n,o);case 17:return g=t.sent,v=g.main,b=g.sub,w=v?b?"".concat(v,".").concat(b):v:"Main",y=n.getText(),t.abrupt("return",new Promise((function(t){pn({word:u,path:n.getPath()||"untitled-"+n.getBuffer().getId(),column:d+1,row:f+1,startRow:h,context:m,onlyGlobal:!1,mod:w,text:y}).then((function(n){n.error&&t({range:new i.Range([0,0],[0,0]),callback:function(){}}),t({range:c,callback:function(){return setTimeout((function(){return e.selectItemsAndGo(n.items)}),5)}})})).catch((function(e){}))})));case 23:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{providerName:"julia-client-hyperclick-provider",priority:100,grammarScopes:atom.config.get("julia-client.juliaSyntaxScopes"),getSuggestion:t}}}]),e}()),wn=Ct.import({rpc:["searchdocs","gotosymbol","moduleinfo"],msg:["regeneratedocs"]}),yn=wn.searchdocs,kn=wn.gotosymbol,jn=wn.moduleinfo,Pn=wn.regeneratedocs;function xn(){return cn.open({split:atom.config.get("julia-client.uiOptions.layouts.documentation.split")})}function Sn(e){return e.html=Zt.render(e.html),Cn(e.html.getElementsByTagName("a")),e.onClickName=function(){kn({word:e.name,mod:e.mod}).then((function(e){if(!e.error)return bn.selectItemsAndGo(e.items)}))},e.onClickModule=function(){jn({mod:e.mod}).then((function(e){var t=e.doc,n=e.items;n.map((function(e){return Sn(e)})),On(Zt.render(t),n)}))},e}function Cn(e){for(var t=function(t){var n=e[t];"@ref"==n.attributes.href.value&&(e[t].onclick=function(){return cn.kwsearch(n.innerText)})},n=0;n<e.length;n++)t(n)}function On(e,t){cn.showDocument(e,t)}var Dn,En,In,Tn,Rn,Ln,An,Bn=Object.freeze({__proto__:null,activate:function(e){(cn=e.DocPane.fromId("Documentation")).search=function(e,t,n,i,o){return Ct.boot(),new Promise((function(r){yn({query:e,mod:t,exportedOnly:n,allPackages:i,nameOnly:o}).then((function(e){if(!e.error){for(var t=0;t<e.items.length;t+=1)e.items[t].score=e.scores[t],e.items[t]=Sn(e.items[t]);e.shoulderase&&cn.modEd.setText("")}r(e)}))}))},cn.regenerateCache=function(){Pn()},(un=new i.CompositeDisposable).add(atom.commands.add("atom-workspace","julia-client:open-documentation-browser",xn)),un.add(atom.commands.add("atom-workspace","julia-client:regenerate-doc-cache",(function(){Pn()}))),un.add(atom.config.observe("julia-client.uiOptions.layouts.documentation.defaultLocation",(function(e){cn.setDefaultLocation(e)})))},open:xn,ensureVisible:function(){return cn.ensureVisible({split:atom.config.get("julia-client.uiOptions.layouts.documentation.split")})},close:function(){return cn.close()},processItem:Sn,processLinks:Cn,showDocument:On,deactivate:function(){un.dispose()}});({client:En}=St),({views:Ln}=Jr),In=bn,Rn=dn,({workspace:An,gotosymbol:Tn,clearLazy:Dn}=En.import({rpc:["workspace","gotosymbol"],msg:"clearLazy"}));var _n,Mn,Fn,Jn,zn,Nn,Hn,Vn,Wn,qn,Un,$n,Gn,Kn,Yn,Zn,Xn,Qn,ei,ti,ni,ii,oi,ri,ai,si,li={activate:function(){return this.create(),En.onDetached(()=>(this.ws.setItems([]),this.lazyTrees=[])),atom.config.observe("julia-client.uiOptions.layouts.workspace.defaultLocation",e=>this.ws.setDefaultLocation(e))},lazyTrees:[],update:function(){var e,t;return En.isActive()&&this.ws.currentPane()?(Dn(this.lazyTrees),t=e=>this.lazyTrees.push(e),e=this.mod===Rn.follow?Rn.current():this.mod||"Main",An(e).then(e=>{var n,i,o,r,a,s;for(n=0,a=e.length;n<a;n++)for(({items:o}=e[n]),r=0,s=o.length;r<s;r++)(i=o[r]).value=Ln.render(i.value,{registerLazy:t}),i.onClick=this.onClick(i.name);return this.ws.setItems(e)}).catch((function(e){}))):this.ws.setItems([])},onClick:function(e){return()=>{var t;return t=this.mod===Rn.follow?Rn.current():this.mod||"Main",Tn({word:e,mod:t}).then(e=>{if(!e.error)return In.selectItemsAndGo(e.items)})}},create:function(){return this.ws=this.ink.Workspace.fromId("julia"),this.ws.setModule=e=>this.mod=e,this.ws.refresh=()=>this.update(),this.ws.refreshModule=()=>{var e;if(null!=(null!=(e=Rn.chooseModule())?e.then:void 0))return e.then(()=>this.update())}},open:function(){return this.ws.open({split:atom.config.get("julia-client.uiOptions.layouts.workspace.split")})},close:function(){return this.ws.close()}};Qn=s,({dialog:qn,BrowserWindow:_n}=b.remote),({client:Wn}=St),({notifications:Xn,views:oi,selector:ii,docpane:Un}=Jr),({paths:ei,blocks:zn,cells:Hn,words:ai,weave:ri}=Oe),({processLinks:ti}=Bn),si=li,Zn=dn,({eval:Kn,evalall:$n,evalshow:Gn,module:Yn,cd:Nn,clearLazy:Vn,activateProject:Jn,activateParentProject:Fn,activateDefaultProject:Mn}=Wn.import({rpc:["eval","evalall","evalshow","module"],msg:["cd","clearLazy","activateProject","activateParentProject","activateDefaultProject"]})),ni=Wn.import("docs");var ui,ci={_currentContext:function(){var e,t,n;return e=atom.workspace.getActiveTextEditor(),n=Zn.current()||"Main",t=Wn.editorPath(e)||"untitled-"+e.getBuffer().id,{editor:e,mod:n,edpath:t}},_showError:function(e,t){var n,i,o,r;return null!=(r=this.errorLines)&&r.lights.destroy(),i=this.ink.highlights.errorLines(function(){var e,i,r;for(r=[],e=0,i=t.length;e<i;e++)({file:n,line:o}=t[e]),r.push({file:n,line:o-1});return r}()),this.errorLines={r:e,lights:i},e.onDidDestroy(()=>{var t;if((null!=(t=this.errorLines)?t.r:void 0)===e)return this.errorLines.lights.destroy()})},eval:function({move:e,cell:t}={}){var n,i,o,r,a,s,l;return({editor:i,mod:a,edpath:o}=this._currentContext()),n=null!=t?Hn:zn,s=atom.config.get("julia-client.uiOptions.resultsDisplayMode"),r=atom.config.get("julia-client.uiOptions.errorInRepl"),l=atom.config.get("julia-client.uiOptions.scrollToResult"),Promise.all(n.get(i).map(({range:u,line:c,text:d,selection:f})=>{var p,m,h,g;return e&&n.moveNext(i,f,u),[[g],[p]]=u,this.ink.highlight(i,g,p),h=s,t&&"console"!==h&&(h="block"),"console"===h?(Gn({text:d,line:c+1,mod:a,path:o}),Xn.show("Evaluation Finished"),si.update()):(m=null,setTimeout(()=>null!=m?m:m=new this.ink.Result(i,[g,p],{type:h,scope:"julia",goto:l}),.1),Kn({text:d,line:c+1,mod:a,path:o,errorInRepl:r}).catch((function(){return null!=m?m.destroy():void 0})).then(e=>{var t,n,o;if(null!=e)return o=(t="error"===e.type)?e.view:e,(null==m||m.isDestroyed)&&(m=new this.ink.Result(i,[g,p],{type:h,scope:"julia",goto:l})),n=function(e){return m.onDidDestroy(Wn.withCurrent((function(){return Vn([e])}))),i.onDidDestroy(Wn.withCurrent((function(){return Vn(e)})))},m.setContent(oi.render(o,{registerLazy:n}),{error:t}),t&&(t&&atom.beep(),this.ink.highlight(i,g,p,"error-line"),null!=e.highlights&&this._showError(m,e.highlights)),Xn.show("Evaluation Finished"),si.update(),e;null!=m&&m.destroy()}))}))},evalAll:function(e){var t,n,i,o,r,a,s,l;if(!e)return({editor:n,mod:r,edpath:i}=this._currentContext()),atom.commands.dispatch(atom.views.getView(n),"inline-results:clear-all"),[s]=n.getRootScopeDescriptor().getScopesArray(),a=(l=["source.weave.md","source.weave.latex"]).includes(s)?r:n.juliaModule,t=l.includes(s)?ri.getCode(n):n.getText(),$n({path:i,module:a,code:t}).then((function(e){return Xn.show("Evaluation Finished"),si.update()})).catch(e=>{});if(!(Qn=ei.getPathFromTreeView(e)))return atom.notifications.addError("This file has no path.");try{return t=ei.readCode(Qn),Yn({path:Qn,code:t,row:1,column:1}).then(e=>$n({path:Qn,module:Zn.current(e),code:t}).then((function(e){return Xn.show("Evaluation Finished"),si.update()})).catch(e=>{})).catch(e=>{})}catch(e){return o=e,atom.notifications.addError("Error happened",{detail:o,dismissable:!0})}},toggleDocs:function(){var e,t,n,i,o,r;if(({editor:t,mod:i,edpath:n}=this._currentContext()),e=t.getLastCursor().getBufferPosition(),({word:r,range:o}=ai.getWordAndRange(t,{bufferPosition:e})),o=ai.getWordRangeWithoutTrailingDots(r,o,e),r=t.getTextInBufferRange(o),ai.isValidWordToInspect(r))return ni({word:r,mod:i}).then(e=>{var n;if(!e.error)return n=oi.render(e),ti(n.getElementsByTagName("a")),"inline"===atom.config.get("julia-client.uiOptions.docsDisplayMode")?new this.ink.InlineDoc(t,o,{content:n,highlight:!0}).view.classList.add("julia"):(Un.ensureVisible(),Un.showDocument(n,[]))}).catch(e=>{})},_cd:function(e){return atom.config.get("julia-client.juliaOptions.persistWorkingDir")&&atom.config.set("julia-client.juliaOptions.workingDir",e),Nn(e)},cdHere:function(e){var t;if(t=this.currentDir(e))return this._cd(t)},activateProject:function(e){var t;if(t=this.currentDir(e))return Jn(t)},activateParentProject:function(e){var t;if(t=this.currentDir(e))return Fn(t)},activateDefaultProject:function(){return Mn()},currentDir:function(e){var t,n;return(t=ei.getDirPathFromTreeView(e))?t:(n=Wn.editorPath(atom.workspace.getCenter().getActiveTextEditor()))?Qn.dirname(n):(atom.notifications.addError("This file has no path."),null)},cdProject:function(){var e;return(e=atom.project.getPaths()).length<1?atom.notifications.addError("This project has no folders."):1===e.length?this._cd(e[0]):ii.show(e,{infoMessage:"Select project to work in"}).then(e=>{if(null!=e)return this._cd(e)}).catch(e=>{})},cdHome:function(){return this._cd(ei.home())},cdSelect:function(){var e;return e={properties:["openDirectory"]},qn.showOpenDialog(_n.getFocusedWindow(),e,e=>{if(null!=e)return this._cd(e[0])})}},di=Ct.import({msg:["changeprompt","changemodule"],rpc:["fullpath"]}),fi=di.changeprompt,pi=di.changemodule,mi=di.fullpath,hi="win32"===process.platform,gi=hi?/(@ ([^\s]+)\s(.*?)\:(\d+)|((([a-zA-Z]:|\.\.?|\~)|([^\0<>\?\|\/\s!$`&*()\[\]+'":;])+)?((\\|\/)([^\0<>\?\|\/!$`&*()\[\]+'":;])+)+\.[^\0<>\?\|\/\s!$`&*()\[\]+'":;]+)(\:\d+)?)/:/(@ ([^\s]+)\s(.*?)\:(\d+)|(((\.\.?|\~)|([^\0\s!$`&*()\[\]+'":;\\])+)?(\/([^\0\s!$`&*()\[\]+'":;\\])+)+)(\:\d+)?)/,vi=[],bi=[],wi=void 0,yi=void 0;function ki(){return ui.open({split:atom.config.get("julia-client.uiOptions.layouts.console.split")})}function ji(e){var t=wi.InkTerminal.fromId("terminal-julia-".concat(Math.floor(1e7*Math.random())),Pi());t.attachCustomKeyEventHandler((function(e){return Ri(e,t)})),t.onDidOpenLink(Ci),t.registerTooltipHandler(Ii,Ti),Di(t.terminal),Li(e).then((function(e){var n=e.pty,i=e.cwd;t.attach(n,!0,i),t.setDefaultLocation(atom.config.get("julia-client.uiOptions.layouts.terminal.defaultLocation")),t.open({split:atom.config.get("julia-client.uiOptions.layouts.terminal.split")}).then((function(){return t.show()})).catch((function(e){}))})).catch((function(){}))}function Pi(){var e={scrollback:atom.config.get("julia-client.consoleOptions.maximumConsoleSize"),cursorStyle:atom.config.get("julia-client.consoleOptions.cursorStyle"),rendererType:atom.config.get("julia-client.consoleOptions.terminalRendererType"),cursorBlink:atom.config.get("julia-client.consoleOptions.cursorBlink")};return"darwin"===process.platform&&(e.macOptionIsMeta=atom.config.get("julia-client.consoleOptions.macOptionIsMeta")),e}function xi(){var e=Pi();Si((function(t){for(var n in e)t.setOption(n,e[n])}),/terminal\-julia\-\d+|julia\-terminal|terminal\-remote\-julia\-\d+/)}function Si(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/terminal\-julia\-\d+/;atom.workspace.getPaneItems().forEach((function(n){n.id&&"InkTerminal"===n.name&&n.id.match(t)&&e(n)}))}function Ci(e){return!atom.config.get("julia-client.consoleOptions.linkModifier")||("darwin"==process.platform?e.metaKey:e.ctrlKey)}function Oi(e,t){if(!Ci(e))return!1;if(Ct.isActive())mi(t).then((function(e){var t=O(e,2),n=t[0],i=t[1];wi.Opener.open(n,i-1,{pending:atom.config.get("core.allowPendingPaneItems")})}));else{var n=t.match(/@ ([^\s]+)\s(.*?)\:(\d+)/);if(n)wi.Opener.open(n[1],parseInt(n[2])-1,{pending:atom.config.get("core.allowPendingPaneItems")});else{var i=hi?/(([a-zA-Z]\:)?[^\:]+)(?:\:(\d+))?/:/([^\:]+)(?:\:(\d+))?/;if(n=t.match(i)){var o=null!==n[2]?parseInt(n[2]):0;wi.Opener.open(n[1],o-1,{pending:atom.config.get("core.allowPendingPaneItems")})}}}}function Di(e){e.registerLinkMatcher(gi,Oi,{willLinkActivate:function(e){return Ci(e)},tooltipCallback:function(t,n,i){return Ii(t,n,i,e)},leaveCallback:function(){return Ti()}})}var Ei=null;function Ii(e,t,n,i){if(Ti(),atom.config.get("julia-client.consoleOptions.linkModifier")){var o=document.createElement("div");o.classList.add("terminal-link-tooltip");var r=i.element.getBoundingClientRect(),a=r.width/i.cols,s=r.height/i.rows,l=n.start.x*a+r.left,u=(n.start.y-1.5)*s+r.top;return o.style.top=u+"px",o.style.left=l+"px",o.innerText=("darwin"==process.platform?"Cmd":"Ctrl")+"-Click to open link.",Ei=o,document.body.appendChild(o),!0}return!1}function Ti(){if(Ei)try{document.body.removeChild(Ei)}catch(e){}finally{Ei=null}}function Ri(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bi;return"win32"!==process.platform&&13===e.keyCode&&(e.altKey||e.metaKey)&&"keydown"===e.type?(t.ty&&t.ty.write("\r"),!1):!(n.indexOf(atom.keymaps.keystrokeForKeyboardEvent(e))>-1)&&e}function Li(e){return process.env.TERM="xterm-256color",new Promise((function(t,n){(e?new Promise((function(t){return t(e)})):zr.show(atom.project.getPaths(),{emptyMessage:"Enter a custom path above.",allowCustom:!0})).then((function(e){if(e){e=De.expandHome(e),l.existsSync(e)||(atom.notifications.addWarning("Path does not exist.",{description:"Defaulting to `HOME` for new terminal's working directory."}),e=De.home());var i=Ke(),o=p.spawn(atom.config.get("julia-client.consoleOptions.shell"),[],{cols:100,rows:30,cwd:e,env:i,useConpty:!0,handleFlowControl:!0});t({pty:o,cwd:e})}else n()}))}))}var Ai=Object.freeze({__proto__:null,get terminal(){return ui},activate:function(e){var t;wi=e,yi=new i.CompositeDisposable,process.env.TERM="xterm-256color",yi.add(atom.config.observe("julia-client.consoleOptions.whitelistedKeybindingsREPL",(function(e){vi=e.map((function(e){return e.toLowerCase()}))})),atom.config.observe("julia-client.consoleOptions.whitelistedKeybindingsTerminal",(function(e){bi=e.map((function(e){return e.toLowerCase()}))})),atom.config.observe("julia-client.consoleOptions.cursorStyle",xi),atom.config.observe("julia-client.consoleOptions.maximumConsoleSize",xi),atom.config.observe("julia-client.consoleOptions.macOptionIsMeta",xi),atom.config.observe("julia-client.consoleOptions.terminalRendererType",xi),atom.config.observe("julia-client.consoleOptions.cursorBlink",xi)),(ui=wi.InkTerminal.fromId("julia-terminal",Pi())).setTitle("REPL",!0),ui.onDidOpenLink(Ci),ui.registerTooltipHandler(Ii,Ti),ui.class="julia-terminal",yi.add(atom.config.observe("julia-client.uiOptions.layouts.console.defaultLocation",(function(e){ui.setDefaultLocation(e)}))),ui.write("[1m[32mPress Enter to start Julia. [0m\n\r"),ui.startRequested=function(){Ct.boot()},ui.attachCustomKeyEventHandler((function(e){return Ri(e,ui,vi)})),dn.onDidChange(r.debounce((function(){return pi({mod:dn.current()})}),200)),Ct.handle({updateWorkspace:function(){return li.update()},clearconsole:function(){return ui.clear()},cursorpos:function(){return ui.cursorPosition()},writeToTerminal:function(e){return!!ui.ty&&(ui.ty.write(e),!0)}}),Ct.onBoot((function(e){ui.attach(e.ty),e.config?ui.setTitle("REPL @ "+e.config.name,!0):ui.setTitle("REPL",!0),e.flush&&e.flush((function(e){return ui.write(e)}),(function(e){return ui.write(e)})),t=atom.config.observe("julia-client.consoleOptions.prompt",(function(e){fi(e+" ")})),Di(ui.terminal)})),Ct.onDetached((function(){ui.setTitle("REPL",!0),ui.detach(),ui.write("[?1049h"),ui.write("[?1049l"),ui.write("[?1003h"),ui.write("[?1003l"),ui.write("[?1004h"),ui.write("[?1004l"),ui.write("\n\r[1m\r[31mJulia has exited.\n\r[32mPress Enter to start a new session.[0m\n\r"),t&&t.dispose()})),yi.add(atom.commands.add("atom-workspace",{"julia-client:open-REPL":function(){ki().then((function(){return ui.show()}))},"julia-client:clear-REPL":function(){ui.clear()}}),atom.commands.add(".julia-terminal",{"julia-client:copy-or-interrupt":function(){ui.copySelection()||atom.commands.dispatch(ui.view,"julia-client:interrupt-julia")}}),atom.commands.add("atom-workspace",{"julia-client:new-terminal":function(){ji()},"julia-client:new-terminal-from-current-folder":function(e){var t=ci.currentDir(e.target);t&&ji(t)},"julia-client:new-remote-terminal":function(){var e;(e=wi.InkTerminal.fromId("terminal-remote-julia-".concat(Math.floor(1e7*Math.random())),Pi())).attachCustomKeyEventHandler((function(t){return Ri(t,e)})),e.onDidOpenLink(Ci),e.registerTooltipHandler(Ii,Ti),Di(e.terminal),rt((function(e){return new Promise((function(t,n){var i=new m.Client;i.on("ready",(function(){i.shell({term:"xterm-256color"},(function(n,o){o.on("close",(function(){i.end()})),o.resize=function(e,t){return o.setWindow(t,e,999,999)},t({pty:o,cwd:"~",conf:e})}))})).connect(e)}))})).then((function(t){var n=t.pty,i=t.cwd,o=t.conf;e.attach(n,!0,i),e.setTitle("Terminal @ ".concat(o.name)),e.setDefaultLocation(atom.config.get("julia-client.uiOptions.layouts.terminal.defaultLocation")),e.open({split:atom.config.get("julia-client.uiOptions.layouts.terminal.split")}).then((function(){return e.show()})),n.on("close",(function(){return e.detach()}))})).catch((function(e){}))}})),Si((function(e){e.ty||(e.attachCustomKeyEventHandler((function(t){return Ri(t,e)})),Di(e.terminal),e.onDidOpenLink(Ci),e.registerTooltipHandler(Ii,Ti),Li(e.persistentState.cwd).then((function(t){var n=t.pty,i=t.cwd;return e.attach(n,!0,i)})).catch((function(){})))}),/terminal\-julia\-\d+/),Si((function(e){return e.close()}),/terminal\-remote\-julia\-\d+/)},open:ki,close:function(){return ui.close()},deactivate:function(){Si((function(e){return e.detach()}),/terminal\-julia\-\d+/),Si((function(e){e.detach(),e.close()}),/terminal\-remote\-julia\-\d+/),ui&&ui.detach(),yi&&yi.dispose(),yi=null}}),Bi=Ct.import("completions"),_i=Ct.import("completiondetail"),Mi=new(function(){function e(){P(this,e),C(this,"selector",".source.julia"),C(this,"disableForSelector",".source.julia .comment"),C(this,"excludeLowerPriority",!0),C(this,"inclusionPriority",1),C(this,"suggestionPriority",atom.config.get("julia-client.juliaOptions.autoCompletionSuggestionPriority")),C(this,"filterSuggestions",!1)}return S(e,[{key:"activate",value:function(){var e=this;this.subscriptions=new i.CompositeDisposable,this.subscriptions.add(atom.config.observe("julia-client.juliaOptions.fuzzyCompletionMode",(function(t){e.fuzzyCompletionMode=t})),atom.config.observe("julia-client.juliaOptions.noAutoParenthesis",(function(t){e.noAutoParenthesis=t})))}},{key:"deactivate",value:function(){this.subscriptions.dispose()}},{key:"getSuggestions",value:function(e){if(!Ct.isActive())return[];var t=e.editor,n=e.bufferPosition,o=e.activatedManually,r=n.row,a=n.column,s=new i.Point(r,0),l=new i.Point(r,a),u=new i.Range(s,l),c=t.getTextInBufferRange(u);if(!o){if(0===a)return[];var d=new i.Point(r,a-1),f=new i.Range(d,n),p=t.getTextInBufferRange(f);if(!t.scopeDescriptorForBufferPosition(n).scopes.includes("meta.bracket.julia")&&!/\b(import|using)\b/.test(c)&&" "===p)return[]}var m=this.baselineCompletions(e,c);return Promise.race([m,this.sleep()])}},{key:"baselineCompletions",value:function(e,t){var n=this,i=e.editor,o=e.bufferPosition,r=o.row,a=o.column,s=e.activatedManually,l=te(i,r),u=l.context,c=l.startRow;return Bi({line:t,path:i.getPath(),mod:dn.current(),context:u,row:r+1,startRow:c,column:a+1,is_fuzzy:this.fuzzyCompletionMode,force:s||!1}).then((function(e){return e.map((function(e){return n.toCompletion(e)}))})).catch((function(){return[]}))}},{key:"toCompletion",value:function(e){var t=this.makeIcon(e.icon);return t&&(e.iconHTML=t),!e.description&&e.descriptionMoreURL&&(e.description=" "),e}},{key:"makeIcon",value:function(e){return e?e.startsWith("icon-")?'<span class="'.concat(e,'"}></span>'):1===e.length?e:"":""}},{key:"sleep",value:function(){return new Promise((function(e){setTimeout((function(){e(null)}),1e3)}))}},{key:"getSuggestionDetailsOnSelect",value:function(e){var t=_i(e).then((function(e){return!e.description&&e.descriptionMoreURL&&(e.description=" "),e})).catch((function(e){}));return Promise.race([t,this.sleep()])}},{key:"onDidInsertSuggestion",value:function(e){var t=e.editor;"function"!==e.suggestion.type||this.noAutoParenthesis||t.mutateSelectedText((function(e){if(e.isEmpty()){var n=e.getBufferRange().start,o=n.row,r=n.column,a=new i.Point(o,r),s=new i.Point(o,r+1),l=new i.Range(a,s),u=new i.Range(s,s);"("!==t.getTextInBufferRange(l)&&e.insertText("()"),e.setBufferRange(u)}}))}}]),e}()),Fi=Nr.tags.webview;var Ji,zi,Ni,Hi,Vi,Wi,qi={activate:function(){var e=this;return Ct.handle({plot:function(t){return e.show(t)},plotsize:function(){return e.plotSize()},ploturl:function(t){return e.ploturl(t)},jlpane:function(t,n){return e.jlpane(t,n)}}),this.create(),atom.config.observe("julia-client.uiOptions.usePlotPane",(function(t){return t?e.pane.setTitle("Plots"):e.pane.setTitle("Plots (disabled)")})),atom.config.observe("julia-client.uiOptions.layouts.plotPane.defaultLocation",(function(t){e.pane.setDefaultLocation(t)}))},create:function(){return this.pane=this.ink.PlotPane.fromId("default")},open:function(){return this.pane.open({split:atom.config.get("julia-client.uiOptions.layouts.plotPane.split")})},ensureVisible:function(){return this.pane.ensureVisible({split:atom.config.get("julia-client.uiOptions.layouts.plotPane.split")})},close:function(){return this.pane.close()},show:function(e){this.ensureVisible();var t=Nr.render(e);return this.pane.show(new this.ink.Pannable(t),{maxSize:atom.config.get("julia-client.uiOptions.maxNumberPlots")}),t},plotSize:function(){var e=this;return this.ensureVisible().then((function(){return{size:e.pane.size(),ratio:window.devicePixelRatio}}))},webview:function(e){var t=e.startsWith("data");if(t){var n=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([i],{type:n})}(e);e=URL.createObjectURL(n)}var i=Nr.render(Fi({class:"blinkjl",src:e,style:"width: 100%; height: 100%"}));return i.classList.add("native-key-bindings"),i.addEventListener("console-message",(function(e){return function(e){var t;0===e.level?t=console.log:1===e.level?t=console.warn:2===e.level&&(t=console.error),t(e.message,"\nat ".concat(e.sourceID,":").concat(e.line))}(e)})),t&&i.addEventListener("dom-ready",(function(t){URL.revokeObjectURL(e)})),i},ploturl:function(e){var t=this.webview(e);return this.ensureVisible(),this.pane.show(t,{maxSize:atom.config.get("julia-client.uiOptions.maxNumberPlots")})},jlpane:function(e,t){null==t&&(t={});var n=void 0;t.url&&(n=this.webview(t.url),t.devtools&&n.addEventListener("dom-ready",(function(){return n.openDevTools()})));var i=this.ink.HTMLPane.fromId(e);return t.close?i.close():t.destroy?i.closeAndDestroy?i.closeAndDestroy():void 0:(i.show({item:n,icon:t.icon,title:t.title}),i.ensureVisible({split:t.split||atom.config.get("julia-client.uiOptions.layouts.plotPane.split")}))}};({BrowserWindow:Ji}=b.remote),Wi=w,({client:zi}=St),({selector:Vi,notifications:Hi}=Jr),({colors:Ni}=Oe);var Ui,$i,Gi,Ki,Yi,Zi,Xi={evalwith:function(e,t){return Wi.runInThisContext(`(function(){return ${t}})`).call(e)},windows:{},activate:function(){return zi.handle({select:function(e){return Vi.show(e)}}),zi.handle({input:function(){return Vi.show([],{allowCustom:!0})}}),zi.handle({syntaxcolors:function(e){return Ni.getColors(e)}}),zi.handle({openFile:(e,t)=>{var n;return null!=(n=this.ink)?n.Opener.open(e,t,{pending:atom.config.get("core.allowPendingPaneItems")}):void 0}}),zi.handle({versionwarning:function(e){return atom.notifications.addWarning("Outdated version of Atom.jl detected.",{description:e,dismissable:!0})}}),zi.handle({createWindow:e=>{var t,n;return t=new Ji(e),null!=e.url&&t.loadURL(e.url),t.setMenu(null),n=t.id,this.windows[n]=t,t.on("close",()=>delete this.windows[n]),n},withWin:(e,t)=>this.evalwith(this.windows[e],t),winActive:e=>this.windows.hasOwnProperty(e),notify:function(e){return Hi.show(e,!0)}}),zi.onDetached(()=>{var e,t,n,i;for(e in n=[],t=this.windows)i=t[e],delete this.windows[e],n.push(i.close());return n})},deactivate:function(){var e,t,n,i;for(e in n=[],t=this.windows)i=t[e],n.push(i.close());return n}},Qi=Ct.import(["debugfile","module"]),eo=Qi.debugfile,to=Qi.module,no='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">\n        <line x1="33.33" y1="20" x2="73.33" y2="20" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="33.33" y1="33.33" x2="73.33" y2="33.33" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="53.33" y1="46.67" x2="73.33" y2="46.67" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polyline points="20 13.33 20 53.33 33.11 53.33" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="29.61 65.3 50.33 53.34 29.61 41.37 29.61 65.3" style="fill:var(--color)"/>\n        <line x1="53.33" y1="60" x2="73.33" y2="60" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n    </svg>\n  ',io='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">\n        <line x1="40" y1="46.67" x2="73.33" y2="46.67" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="40" y1="60" x2="73.33" y2="60" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="53.33" y1="20" x2="73.33" y2="20" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polyline points="46.67 26.67 20 26.67 20 49.45" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="8.03 45.94 20 66.67 31.97 45.94 8.03 45.94" style="fill:var(--color)"/>\n        <line x1="53.33" y1="33.33" x2="73.33" y2="33.33" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n    </svg>\n  ',oo='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">\n        <line x1="40" y1="20" x2="73.33" y2="20" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="40" y1="33.33" x2="73.33" y2="33.33" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="20" y1="13.33" x2="20" y2="49.44" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="8.03 45.94 20 66.67 31.97 45.94 8.03 45.94" style="fill:var(--color)"/>\n        <line x1="40" y1="46.67" x2="73.33" y2="46.67" style="fill:none;stroke:var(--color-highlight);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="20" y1="13.33" x2="20" y2="49.44" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="8.03 45.94 20 66.67 31.97 45.94 8.03 45.94" style="fill:var(--color)"/>\n        <line x1="73.33" y1="60" x2="40" y2="60" style="fill:none;stroke:var(--color-subtle);stroke-miterlimit:10;stroke-width:8px"/>\n    </svg>\n  ',ro='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">\n        <line x1="40" y1="20" x2="73.33" y2="20" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="40" y1="33.33" x2="73.33" y2="33.33" style="fill:none;stroke:var(--color-subtle);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="40" y1="46.67" x2="73.33" y2="46.67" style="fill:none;stroke:var(--color-subtle);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="20" y1="13.33" x2="20" y2="49.44" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="8.03 45.94 20 66.67 31.97 45.94 8.03 45.94" style="fill:var(--color)"/>\n        <line x1="40" y1="60" x2="73.33" y2="60" style="fill:none;stroke:var(--color-subtle);stroke-miterlimit:10;stroke-width:8px"/>\n        <line x1="20" y1="13.33" x2="20" y2="49.44" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="8.03 45.94 20 66.67 31.97 45.94 8.03 45.94" style="fill:var(--color)"/>\n    </svg>\n  ',ao='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80">\n        <path d="M23.08,35.74V40H8.79V17.26H23.08v4.26H13.66v5.06h8.87V30.5H13.66v5.25Z" style="fill:var(--color)"/>\n        <path d="M33.36,34.33h-.18L30.36,40H25.45l4.94-8.54-4.94-8.68h5.34l2.63,5.63h.19l2.63-5.63h5.11l-5,8.53,5,8.7H36.22Z" style="fill:var(--color)"/>\n        <path d="M53.35,22.54a5.62,5.62,0,0,1,4.79,2.34,10.78,10.78,0,0,1,1.73,6.52,10.86,10.86,0,0,1-1.71,6.5,6,6,0,0,1-7.74,1.55,4.77,4.77,0,0,1-1.88-2.22h-.18v8.42H43.67V22.77h4.61v2.9h.18a5.05,5.05,0,0,1,1.93-2.3A5.36,5.36,0,0,1,53.35,22.54Zm-1.66,13.7a2.85,2.85,0,0,0,2.46-1.29,6.09,6.09,0,0,0,.91-3.55,6.14,6.14,0,0,0-.91-3.55,3,3,0,0,0-4.91,0,6.18,6.18,0,0,0-.93,3.54,6.17,6.17,0,0,0,.92,3.54A2.84,2.84,0,0,0,51.69,36.23Z" style="fill:var(--color)"/>\n        <path d="M62.63,40V22.77h4.55v3h.19a4.3,4.3,0,0,1,1.41-2.35,3.82,3.82,0,0,1,2.52-.87,4.63,4.63,0,0,1,1.52.2v4.37A4.77,4.77,0,0,0,71,26.82a3.5,3.5,0,0,0-2.66,1,3.89,3.89,0,0,0-1,2.81V40Z" style="fill:var(--color)"/>\n        <polyline points="6.67 60 33.33 60 56.69 60" style="fill:none;stroke:var(--color);stroke-miterlimit:10;stroke-width:8px"/>\n        <polygon points="53.3 71.57 73.33 60 53.3 48.43 53.3 71.57" style="fill:var(--color)"/>\n    </svg>\n  ';function so(e,t){!function(e){return!Ui&&(void 0===e.originalEvent&&atom.notifications.addError("You need to be debugging to do that.",{description:"You can start debugging by calling `Juno.@enter f(args...)` from the integrated REPL.",dismissable:!0}),!0)}(e)?t():e.abortKeyBinding()}function lo(e){Ui?atom.notifications.addError("Can't start a debugging session while debugging.",{description:"Please finish the current session first.",dismissable:!0}):e()}function uo(e){(Ui=e)?Yi.ensureVisible():($i.destroy(),li.update(),Yi.reset())}function co(e){return St.boot(),Ct.import("toggleBP")(e)}function fo(){return St.boot(),Ct.import("clearbps")()}function po(){return St.boot(),Ct.import("toggleUncaught")()}function mo(){return St.boot(),Ct.import("toggleException")()}function ho(){return St.boot(),Ct.import("toggleCompiled")()}function go(){return St.boot(),Ct.import("getBreakpoints")()}function vo(e){return St.boot(),Ct.import("addArgs")(e)}function bo(e){return St.boot(),Ct.import("toggleAllActiveBP")(e)}function wo(e){return St.boot(),Ct.import("toggleActiveBP")(e)}function yo(e,t){return St.boot(),Ct.import("addConditionById")(e,t)}function ko(e){return St.boot(),Ct.import("setStackLevel")(e)}Ct.handle({debugmode:uo,stepto:function(e,t,n,i){$i.step(e,t-1,Nr.render(n),i),li.update()},working:function(){Ct.ipc.loading.working()},doneWorking:function(){Ct.ipc.loading.done()},getFileBreakpoints:function(){return Ki.getFileBreakpoints().filter((function(e){return e.isactive})).map((function(e){return{file:e.file,line:e.line,condition:e.condition}}))}});var jo,Po,xo=Object.freeze({__proto__:null,activate:function(e){var t=[{icon:"playback-fast-forward",tooltip:"Debug: Continue",command:"julia-debug:continue",color:"success"},{tooltip:"Debug: Next Line",command:"julia-debug:step-to-next-line",svg:ro},{tooltip:"Debug: Step to Selected Line",command:"julia-debug:step-to-selected-line",svg:oo},{tooltip:"Debug: Next Expression",command:"julia-debug:step-to-next-expression",svg:ao},{tooltip:"Debug: Step Into",command:"julia-debug:step-into",svg:no},{tooltip:"Debug: Step Out",command:"julia-debug:step-out",svg:io},{icon:"x",tooltip:"Debug: Stop Debugging",command:"julia-debug:stop-debugging",color:"error"}];$i=new(Zi=e).Stepper({buttons:t,pending:!atom.config.get("julia-client.uiOptions.openNewEditorWhenDebugging")}),Ki=new Zi.breakpoints(atom.config.get("julia-client.juliaSyntaxScopes"),{toggle:co,clear:fo,toggleUncaught:po,toggleException:mo,refresh:go,addArgs:vo,toggleActive:wo,toggleAllActive:bo,addCondition:yo,setLevel:ko,toggleCompiled:ho}),Yi=Zi.DebuggerPane.fromId("julia-debugger-pane",$i,Ki,t,[{text:"Run File",tooltip:"Debug: Run File",command:"julia-debug:run-file"},{text:"Step Through File",tooltip:"Debug: Step Through File",command:"julia-debug:step-through-file"},{text:"Run Block",tooltip:"Debug: Run Block",command:"julia-debug:run-block"},{text:"Step Through Block",tooltip:"Debug: Step Through Block",command:"julia-debug:step-through-block"}]),(Gi=new i.CompositeDisposable).add(atom.config.observe("julia-client.uiOptions.layouts.debuggerPane.defaultLocation",(function(e){Yi.setDefaultLocation(e)}))),Gi.add(Ct.onDetached((function(){uo(!1),Ki.clear(!0)})))},deactivate:function(){Ki.destroy(),Gi.dispose()},open:function(){return Yi.open({split:atom.config.get("julia-client.uiOptions.layouts.debuggerPane.split")})},close:function(){return Yi.close()},finish:function(e){so(e,(function(){return Ct.import("finish")()}))},nextline:function(e){so(e,(function(){return Ct.import("nextline")()}))},stepexpr:function(e){so(e,(function(){return Ct.import("stepexpr")()}))},stepin:function(e){so(e,(function(){return Ct.import("stepin")()}))},stop:function(e){so(e,(function(){return Ct.import("stop")()}))},continueForward:function(e){so(e,(function(){return Ct.import("continue")()}))},toselectedline:function(e){so(e,(function(){var e=$i.edForFile($i.file);null!=e&&Ct.import("toline")(e.getCursorBufferPosition().row+1)}))},debugFile:function(e,t){lo((function(){if(t){var n=De.getPathFromTreeView(t);if(!n)return void atom.notifications.addError("This file has no path.");try{var i=De.readCode(n);to({path:n,code:i,row:1,column:1}).then((function(t){eo(dn.current(t),i,n,e)})).catch((function(e){}))}catch(e){atom.notifications.addError("Error happened",{detail:e,dismissable:!0})}}else{var o=atom.workspace.getActiveTextEditor();if(!o||!o.getGrammar||"source.julia"!==o.getGrammar().id)return void atom.notifications.addError("Can't debug current file.",{description:"Please make sure a Julia file is open in the workspace."});var r=Ct.editorPath(o)||"untitled-"+o.getBuffer().id,a=dn.current()||"Main";eo(a,o.getText(),r,e)}}))},debugBlock:function(e,t){lo((function(){var n=atom.workspace.getActiveTextEditor();if(n){var i=Ct.editorPath(n)||"untitled-"+n.getBuffer().id,o=dn.current()||"Main",r=(t?Ie:Ee).get(n);if(0!==r.length){var a=r[0],s=a.range,l=a.text,u=a.line,c=O(s,2),d=O(c[0],1)[0],f=O(c[1],1)[0];Zi.highlight(n,d,f),eo(o,l,i,e,u)}}else atom.notifications.addError("Can't debug current code block.",{description:"Please make sure a file is open in the workspace."})}))},clearbps:function(){St.boot(),Ki.clear(),Ct.isActive()&&Ct.import("clearbps")()},togglebp:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:atom.workspace.getActiveTextEditor();if(t&&t.getPath()){var n=Ct.editorPath(t);t.getCursors().map((function(t){var i=t.getBufferPosition().row+1;e?Ki.toggleConditionAtSourceLocation({file:n,line:i}):Ki.toggleAtSourceLocation({file:n,line:i})}))}else atom.notifications.addError("Need a saved file to add a breakpoint")}}),So=Ct.import({msg:["loadProfileTrace","saveProfileTrace"]}),Co=So.loadProfileTrace,Oo=So.saveProfileTrace;function Do(){jo.teardown()}var Eo,Io,To,Ro,Lo=Object.freeze({__proto__:null,activate:function(e){(jo=e.PlotPane.fromId("Profile")).getTitle=function(){return"Profiler"},(Po=new i.CompositeDisposable).add(Ct.onDetached((function(){return Do()}))),Po.add(atom.config.observe("julia-client.uiOptions.layouts.profiler.defaultLocation",(function(e){jo.setDefaultLocation(e)}))),Ct.handle({profile:function(t){var n=new e.Profiler.ProfileViewer({data:t,save:function(e){return Oo(e,t)},customClass:"julia-profile"});jo.ensureVisible({split:atom.config.get("julia-client.uiOptions.layouts.profiler.split")}),jo.show(new e.Pannable(n,{zoomstrategy:"width",minScale:.5}))}}),Po.add(atom.commands.add("atom-workspace","julia-client:clear-profile",(function(){Do(),jo.close()}))),Po.add(atom.commands.add("atom-workspace","julia-client:load-profile-trace",(function(){var e=v.remote.dialog.showOpenDialog({title:"Load Profile Trace",properties:["openFile"]});Co(e)})))},deactivate:function(){Po.dispose()}}),Ao=Ct.import("updateeditor");function Bo(e){e&&e instanceof i.TextEditor&&(To&&To.dispose(),To=new i.CompositeDisposable,"source.julia"!==e.getGrammar().id?Eo.setItems([]):(To.add(e.onDidStopChanging(r.throttle((function(){return _o(e)}),300)),e.onDidChangeCursorPosition(r.throttle((function(){return function(e){var t=e.getCursorBufferPosition().row+1;Ro=Ro.map((function(e){return e.isActive=e.start<=t&&t<=e.stop,e})),Eo.setItems(Ro)}(e)}),300))),_o(e,{updateSymbols:!1})),To.add(e.onDidDestroy((function(){Ro=[],Eo.setItems([])})),e.onDidChangeGrammar((function(t){Bo(e)}))))}function _o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{updateSymbols:!0};if(!Ct.isActive())return new Promise((function(e){return e([])}));var n=e.getText(),i=dn.current(),o=i||"Main",r=e.getPath()||"untitled-"+e.getBuffer().getId();Ao({text:n,mod:o,path:r,updateSymbols:t.updateSymbols}).then((function(t){Ro=Mo(e,t)})).catch((function(e){}))}function Mo(e,t){var n=e.getCursorBufferPosition().row+1;return t=t.map((function(t){return t.isActive=t.start<=n&&n<=t.stop,t.onClick=function(){var n,i=T(atom.workspace.getPanes());try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.getItems().includes(e)){o.activate(),o.setActiveItem(e),e.setCursorBufferPosition([t.start-1,0]),e.scrollToCursorPosition();break}}}catch(e){i.e(e)}finally{i.f()}},t})),Eo.setItems(t),t}var Fo,Jo,zo=Object.freeze({__proto__:null,activate:function(e){Eo=e.Outline.fromId("Julia-Outline"),Io=new i.CompositeDisposable,To=new i.CompositeDisposable,Ro=[],Io.add(atom.config.observe("julia-client.uiOptions.layouts.outline.defaultLocation",(function(e){Eo.setDefaultLocation(e)})),atom.workspace.onDidStopChangingActivePaneItem(r.throttle((function(e){return Bo(e)}),300)),atom.packages.onDidActivateInitialPackages((function(){return Bo(atom.workspace.getActivePaneItem())})),Ct.onDetached((function(){Ro=[],Eo.setItems([])})),new i.Disposable((function(){Ro=[],Eo.setItems([]),To&&To.dispose()})))},open:function(){return Eo.open({split:atom.config.get("julia-client.uiOptions.layouts.outline.split")})},close:function(){return Eo.close()},deactivate:function(){Io&&Io.dispose()}});var No=Object.freeze({__proto__:null,activate:function(e){var t=e.Linter;Jo=t.lintPane,Ct.handle({staticLint:function(e){Jo.ensureVisible({split:atom.config.get("julia-client.uiOptions.layouts.linter.split")}),t.setItems(e)}}),(Fo=new i.CompositeDisposable).add(atom.commands.add(".workspace",{"julia-client:clear-linter":function(){return t.clearItems()}})),Fo.add(atom.config.observe("julia-client.uiOptions.layouts.linter.defaultLocation",(function(e){Jo.setDefaultLocation(e)})))},open:function(){return Jo.open({split:atom.config.get("julia-client.uiOptions.layouts.linter.split")})},close:function(){return Jo.close()},deactivate:function(){Fo&&Fo.dispose()}}),Ho=Ct.import({rpc:["packages"]}).packages;var Vo=Object.freeze({__proto__:null,openPackage:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Ho();t.then((function(t){var n=[];for(var i in t)n.push({primary:i,secondary:t[i]});zr.show(n,{infoMessage:"Select package to open"}).then((function(n){n&&(e?atom.open({pathsToOpen:[t[n.primary]]}):atom.project.addPath(t[n.primary],{mustExist:!0,exact:!0}))}))})).catch((function(){atom.notifications.addError("Couldn't find your Julia packages.")}))}}),Wo=Ct.import(["reportinfo"]).reportinfo;function qo(e){atom.notifications.addInfo("Juno Debug Info",{description:"Please provide the info above when you report an issue. Make sure to strip it of any kind of sensitive info you might not want to share.",detail:e,dismissable:!0,buttons:[{text:"Copy to Clipboard",onDidClick:function(){atom.clipboard.write(e)}}]})}var Uo,$o=Ct.import("format");function Go(e){var t=e.getBuffer().getRange();return Ko(e,t,e.getText())}function Ko(e,t,n){var i=s.dirname(Ct.editorPath(e)),o=function(e,t){var n=e.markBufferRange(t,{invalidate:"inside"});return e.decorateMarker(n,{type:"highlight",class:"ink-block"}),n}(e,t),r=e.getTabLength(),a=e.getPreferredLineLength();$o({text:n,dir:i,indent:r,margin:a}).then((function(t){var n=t.error,i=t.formattedtext;n?atom.notifications.addError("Julia-Client: Format-Code",{description:n,dismissable:!0}):o.isValid()?e.setTextInBufferRange(o.getBufferRange(),i):atom.notifications.addError("Julia-Client: Format-Code",{description:"Cancelled the formatting task because the selected code has been manually modified.",dismissable:!0})})).catch((function(e){})).finally((function(){o.destroy()}))}var Yo,Zo,Xo=Object.freeze({__proto__:null,formatCode:function(){var e=atom.workspace.getActiveTextEditor();if(e){var t=e.getSelections();1!==t.length||t[0].getText()?t.forEach((function(t){!function(e,t){var n=t.getBufferRange();Ko(e,n,t.getText())}(e,t)})):Go(e)}},activate:function(){Uo=new i.CompositeDisposable;var e=new WeakSet;Uo.add(atom.workspace.observeTextEditors((function(t){e.add(t);var n=t.getBuffer().onDidSave((function(){t&&t.getGrammar&&"source.julia"===t.getGrammar().id&&Ct.isActive()&&e.has(t)&&Go(t).then((function(){e.delete(t),t.save().then((function(){e.add(t)})).catch((function(e){}))})).catch((function(e){}))}));Uo.add(n),Uo.add(t.onDidDestroy((function(){n.dispose()})))})))},deactivate:function(){Uo&&Uo.dispose&&Uo.dispose()}}),Qo=Ct.import("datatip"),er=atom.grammars.grammarForScopeName("source.julia"),tr=new(function(){function e(){P(this,e),C(this,"providerName","julia-client-datatip-provider"),C(this,"priority",100),C(this,"grammarScopes",atom.config.get("julia-client.juliaSyntaxScopes")),C(this,"useAtomIDEUI",!1)}var t;return S(e,[{key:"datatip",value:(t=j(regeneratorRuntime.mark((function e(t,n){var i,o,r,a,s,l,u,c,d,f,p,m,h,g,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ct.isActive()){e.next=2;break}return e.abrupt("return");case 2:if(q(t,n)){e.next=4;break}return e.abrupt("return");case 4:if(i=ge(t,{bufferPosition:n}),o=i.range,r=i.word,o=be(r,o,n),we(r=t.getTextInBufferRange(o))){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,dn.getEditorModule(t,n);case 11:return a=e.sent,s=a.main,l=a.sub,u=s?l?"".concat(s,".").concat(l):s:"Main",c=n.column,d=n.row,f=te(t,d),p=f.context,m=f.startRow,e.prev=17,e.next=20,Qo({word:r,mod:u,path:t.getPath(),column:c+1,row:d+1,startRow:m,context:p});case 20:if(!(h=e.sent).error){e.next=23;break}return e.abrupt("return");case 23:if(!this.useAtomIDEUI){e.next=33;break}if(!h.line){e.next=29;break}return g=t.lineTextForBufferRow(h.line).trim(),e.abrupt("return",{range:o,markedStrings:[{type:"snippet",value:g,grammar:er}]});case 29:if(!h.strings){e.next=31;break}return e.abrupt("return",{range:o,markedStrings:h.strings.map((function(e){return{type:e.type,value:e.value,grammar:"snippet"===e.type?er:null}}))});case 31:e.next=40;break;case 33:if(!h.line){e.next=38;break}return v=t.lineTextForBufferRow(h.line).trim(),e.abrupt("return",{range:o,markedStrings:[{type:"snippet",value:v,grammar:er}]});case 38:if(!h.strings){e.next=40;break}return e.abrupt("return",{range:o,markedStrings:h.strings.map((function(e){return{type:"markdown",value:"snippet"===e.type?"```julia\n".concat(e.value,"\n```"):e.value,grammar:"snippet"===e.type?er:null}}))});case 40:e.next=45;break;case 42:return e.prev=42,e.t0=e.catch(17),e.abrupt("return");case 45:case"end":return e.stop()}}),e,this,[[17,42]])}))),function(e,n){return t.apply(this,arguments)})}]),e}()),nr=Ct.import({rpc:["moduleinfo"]}).moduleinfo,ir=Ct.import("docs");({CompositeDisposable:Yo,Disposable:Zo}=o);var or={modules:dn,evaluation:ci,console:Ai,completions:Mi,workspace:li,plots:qi,frontend:Xi,debugger:xo,profiler:Lo,outline:zo,linter:No,packages:Vo,debuginfo:function(){var e="# Atom:\nVersion: ".concat(atom.getVersion(),"\nDev Mode: ").concat(atom.inDevMode(),"\nOfficial Release: ").concat(atom.isReleasedVersion(),"\n").concat(JSON.stringify(process.versions,null,2),"\n"),t=["julia-client","ink","uber-juno","language-julia","language-weave","indent-detective","latex-completions"];t.forEach((function(n,i){e+="# "+t[i]+":";var o=atom.packages.getActivePackage(n);e+=o?"\nVersion: ".concat(o.metadata.version,"\nConfig:\n").concat(JSON.stringify(o.config.settings[n],null,2),"\n"):"not installed\n",e+="\n\n"})),Wo().then((function(t){e+="# versioninfo():\n",qo(e+=t)})).catch((function(t){qo(e+="Could not connect to Julia.")}))},formatter:Xo,goto:bn,activate:function(){return this.subs=new Yo,this.modules.activate(),this.completions.activate(),this.frontend.activate(),this.subs.add(atom.config.observe("julia-client.juliaOptions.formatOnSave",e=>e?this.formatter.activate():this.formatter.deactivate())),this.subs.add(new Zo(()=>{var e,t,n,i,o;for(o=[],e=0,t=(i=[this.modules,this.completions,this.frontend,this.formatter]).length;e<t;e++)n=i[e],o.push(n.deactivate());return o}))},deactivate:function(){return this.subs.dispose()},consumeInk:function(e){var t,n,i,o,r,a,s;for(this.evaluation.ink=e,this.frontend.ink=e,t=0,i=(a=[this.console,this.debugger,this.profiler,this.linter,this.goto,this.outline]).length;t<i;t++)(r=a[t]).activate(e);for(n=0,o=(s=[this.workspace,this.plots]).length;n<o;n++)(r=s[n]).ink=e,r.activate();return this.subs.add(new Zo(()=>{var e,t,n,i;for(i=[],e=0,t=(n=[this.console,this.debugger,this.profiler,this.linter,this.goto,this.outline]).length;e<t;e++)r=n[e],i.push(r.deactivate());return i}))},provideAutoComplete:function(){return this.completions},provideHyperclick:function(){return this.goto.provideHyperclick()},consumeStatusBar:function(e){return this.modules.consumeStatusBar(e)},consumeDatatip:function(e){var t,n;return n=tr,"DatatipManager"===e.constructor.name?n.useAtomIDEUI=!0:atom.config.set("atom-ide-datatip",{showDataTipOnCursorMove:!1,showDataTipOnMouseMove:!0}),t=e.addProvider(n),this.subs.add(t),t},handleURI:function(e){var t=e.query;if(t.open)atom.workspace.open(t.file,{initialLine:Number(t.line),pending:atom.config.get("core.allowPendingPaneItems")});else if(t.docs){var n=t.word,i=t.mod;ir({word:n,mod:i}).then((function(e){if(!e.error){var t=Nr.render(e);Hr.processLinks(t.getElementsByTagName("a")),Hr.ensureVisible(),Hr.showDocument(t,[])}})).catch((function(e){}))}else if(t.moduleinfo){var o=t.mod;nr({mod:o}).then((function(e){var t=e.doc,n=e.items;n.map((function(e){Hr.processItem(e)}));var i=Nr.render(t);Hr.ensureVisible(),Hr.showDocument(i,n)})).catch((function(e){}))}}},rr=function(){return or.console},ar=function(){return or.workspace},sr=function(){return Jr.docpane},lr=function(){return or.plots},ur=function(){return or.debugger},cr=function(){return or.linter},dr=function(){return or.outline};function fr(){var e=[];return atom.config.get("julia-client.uiOptions.layouts.defaultPanes.console")&&e.push(rr),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.workspace")&&e.push(ar),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.documentation")&&e.push(sr),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.plotPane")&&e.push(lr),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.debuggerPane")&&e.push(ur),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.linter")&&e.push(cr),atom.config.get("julia-client.uiOptions.layouts.defaultPanes.outline")&&e.push(dr),e}function pr(){return fr().map((function(e){return e().close()}))}function mr(){!function e(t){if(0===t.length)return atom.workspace.getPanes().forEach((function(e){e.activateItemAtIndex(0)})),void atom.workspace.getCenter().activate();var n=t.shift();n().open().catch((function(e){n().open()})).finally((function(){atom.workspace.getActivePaneContainer().activatePreviousPane(),e(t)}))}(fr())}function hr(){Promise.all(pr()).then((function(){var e;(e=[]).push(atom.workspace.getCenter()),e.push(atom.workspace.getLeftDock()),e.push(atom.workspace.getBottomDock()),e.push(atom.workspace.getRightDock()),e.forEach((function(e){var t=e.getPanes(),n=t[0];t.slice(1).forEach((function(e){e.getItems().forEach((function(t){e.moveItemToPane(t,n)}))}))})),mr()}))}var gr,vr,br,wr=Object.freeze({__proto__:null,closePromises:pr,restoreDefaultLayout:hr,resetDefaultLayoutSettings:function(){var e=atom.config.get("julia-client.uiOptions.layouts.openDefaultPanesOnStartUp");atom.config.unset("julia-client.uiOptions.layouts"),atom.config.set("julia-client.uiOptions.layouts.openDefaultPanesOnStartUp",e)},queryDefaultLayout:function(){var e=atom.notifications.addInfo("Julia-Client: Open Juno-specific panes on startup ?",{buttons:[{text:"Yes",onDidClick:function(){hr(),e.dismiss(),atom.config.set("julia-client.firstBoot",!1),atom.config.set("julia-client.uiOptions.layouts.openDefaultPanesOnStartUp",!0)}},{text:"No",onDidClick:function(){e.dismiss(),atom.config.set("julia-client.firstBoot",!1),atom.config.set("julia-client.uiOptions.layouts.openDefaultPanesOnStartUp",!1)}}],description:"You can specify the panes to be opened and their _default location_ and _splitting rule_ in\n       **`Packages -> Juno -> Settings -> Julia-Client -> UI Options -> Layout Options`**.\n       `Julia-Client: Restore-Default-Layout` command will restore the layout at later point in time.\n       Use `Julia-Client: Reset-Default-Layout-Settings` command to reset the layout settings if it gets messed up.",dismissable:!0})}}),yr=function(){function e(t){P(this,e),this.size=t,this.history=[],this.openedItem=void 0}return S(e,[{key:"push",value:function(e){if(!(this.openedItem&&this.openedItem.file&&this.openedItem.line&&e.file==this.openedItem.file&&e.line==this.openedItem.line))for(this.history.push(e);this.history.length>this.size;)this.history.shift()}},{key:"moveBack",value:function(){var e=this.history.pop();if(e&&e.open){var t=atom.workspace.getActivePaneItem();if(t instanceof i.TextEditor){var n=t.getPath()||"untitled-"+t.buffer.getId(),o=t.getCursorBufferPosition().row;this.openedItem={file:n,line:o}}e.open()}}}]),e}();var kr,jr,Pr,xr=Object.freeze({__proto__:null,activate:function(e){(br=new i.CompositeDisposable).add(atom.workspace.onDidStopChangingActivePaneItem((function(t){t instanceof i.TextEditor?gr=t:t instanceof e.InkTerminal&&(vr=t)})),atom.packages.onDidActivateInitialPackages((function(){gr=atom.workspace.getActiveTextEditor(),atom.workspace.getPanes().forEach((function(t){var n=t.getActiveItem();n instanceof e.InkTerminal&&(vr=n)}))})));var t=new yr(30);e.Opener.onDidOpen((function(e){e.newLocation;var n=e.oldLocation;n&&t.push(n)})),br.add(atom.commands.add("atom-workspace",{"julia-client:focus-last-editor":function(){return function(){var e=atom.workspace.paneForItem(gr);e&&(e.activate(),e.activateItem(gr))}()},"julia-client:focus-last-terminal":function(){vr&&vr.open&&vr.open()},"julia-client:return-from-goto":function(){return t.moveBack()}}))},deactivate:function(){gr=null,vr=null,br.dispose(),br=null}}),Sr=[];function Cr(e,t,n){if(0===n.length)return t&&t.destroy&&t.destroy(),null;var i=ie(e);if(i[1].row+=1,i[1].column=0,t&&t.destroy){var o=t.getBufferRange();if(o.start.row==i[0].row&&o.end.row==i[1].row)return t;t.destroy()}return t=e.markBufferRange(i),e.decorateMarker(t,{type:"line-number",class:"julia-current-cell"}),e.decorateMarker(t,{type:"line",class:"julia-current-cell"}),t}function Or(e,t){t.forEach((function(e){return e.destroy()}));var n="^("+atom.config.get("julia-client.uiOptions.cellDelimiter").join("|")+")",i=new RegExp(n),o=e.getBuffer();t=[];for(var r=0;r<=o.getEndPosition().row;r++){var a=$(e,r),s=a.line,l=a.scope;if(i.test(s)&&l.join(".").indexOf("comment.line")>-1){var u=e.markBufferRange([[r,0],[r,1/0]]);e.decorateMarker(u,{type:"line",class:"julia-cell-border"}),t.push(u)}}return t}var Dr,Er,Ir=Object.freeze({__proto__:null,activate:function(){kr=new i.CompositeDisposable,jr=new i.CompositeDisposable,kr.add(atom.workspace.observeActiveTextEditor((function(e){e&&e.getGrammar&&"source.julia"===e.getGrammar().id&&(jr&&jr.dispose&&(jr.dispose(),jr=new i.CompositeDisposable),Sr=Or(e,Sr),Pr=Cr(e,Pr,Sr),jr.add(e.onDidChangeCursorPosition((function(t){Pr=Cr(e,Pr,Sr)}))),jr.add(e.onDidStopChanging((function(){Sr=Or(e,Sr),Pr=Cr(e,Pr,Sr)}))),jr.add(e.onDidDestroy((function(){Pr&&Pr.destroy&&Pr.destroy(),Sr.forEach((function(e){return e.destroy()})),jr.dispose()}))),jr.add(e.onDidChangeGrammar((function(t){Pr&&Pr.destroy&&Pr.destroy(),Sr.forEach((function(e){return e.destroy()})),"source.julia"==e.getGrammar().id&&(Sr=Or(e,Sr),Pr=Cr(e,Pr,Sr))}))))})))},deactivate:function(){Pr&&Pr.destroy&&Pr.destroy(),Sr.forEach((function(e){return e.destroy()})),Pr=null,Sr=[],kr&&kr.dispose&&kr.dispose(),jr&&jr.dispose&&jr.dispose()}});({CompositeDisposable:Dr,Disposable:Er}=o);var Tr,Rr,Lr,Ar,Br,_r,Mr,Fr,Jr={notifications:Ft,selector:$t,views:Zt,progress:ln,layout:wr,docpane:Bn,focusutils:xr,cellhighlighter:Ir,activate:function(e){return this.client=e,this.subs=new Dr,this.notifications.activate(),this.subs.add(atom.config.observe("julia-client.uiOptions.highlightCells",e=>e?this.cellhighlighter.activate():this.cellhighlighter.deactivate())),this.subs.add(new Er(()=>this.cellhighlighter.deactivate())),this.subs.add(this.client.onAttached(()=>this.notifications.show("Client Connected"))),this.subs.add(this.client.onDetached(()=>{var e;return null!=(e=this.ink)?e.Result.invalidateAll():void 0}))},deactivate:function(){return this.subs.dispose()},consumeInk:function(e){return this.ink=e,this.views.ink=this.ink,this.progress.ink=this.ink,this.selector.activate(this.ink),this.docpane.activate(this.ink),this.progress.activate(),this.focusutils.activate(this.ink),this.subs.add(new Er(()=>(this.docpane.deactivate(),this.progress.deactivate(),this.focusutils.deactivate())))}},zr=Jr.selector,Nr=Jr.views,Hr=Jr.docpane;Ar=t,Lr=le,Br=Et,Mr=_t,Fr=Mt,_r=h,Tr="[`ink`](https://github.com/JunoLab/atom-ink)",Rr="[`language-julia`](https://github.com/JuliaEditorSupport/atom-language-julia)";var Vr={misc:Oe,ui:Jr,connection:St,runtime:or,activate:function(e){var t,n,i;for(Ar.setScheduler(atom.views),process.env.TERM="xterm-256color",Lr.activate(this),t=0,n=(i=[Br,this.connection,this.runtime]).length;t<n;t++)i[t].activate();return this.ui.activate(this.connection.client),this.requireDeps(()=>(Mr.updateSettings(),atom.config.get("julia-client.firstBoot")?this.ui.layout.queryDefaultLayout():atom.config.get("julia-client.uiOptions.layouts.openDefaultPanesOnStartUp")?setTimeout(()=>this.ui.layout.restoreDefaultLayout(),150):void 0))},requireDeps:function(e){return atom.packages.isPackageLoaded("ink")&&atom.packages.isPackageLoaded("language-julia")?e():y.install("julia-client").then(()=>this.enableDeps(e)).catch((function(e){return atom.notifications.addError("Installing Juno's dependencies failed.",{description:`Juno requires the packages ${Tr} and ${Rr} to run.\nPlease install them manually via \`File -> Settings -> Packages\`,\nor open a terminal and run\n\n    apm install ink\n    apm install language-julia\n\nand then restart Atom.`,dismissable:!0})}))},enableDeps:function(e){var t;return atom.packages.isPackageLoaded("ink")&&atom.packages.isPackageLoaded("language-julia")?e():(atom.packages.enablePackage("ink"),atom.packages.enablePackage("language-julia"),atom.packages.isPackageLoaded("ink")&&atom.packages.isPackageLoaded("language-julia")?(atom.notifications.addSuccess("Automatically enabled Juno's dependencies.",{description:`Juno requires the ${Tr} and ${Rr} packages.\nWe've automatically enabled them for you.`,dismissable:!0}),t=atom.packages.loadedPackages.ink.metadata.version,atom.devMode||_r.satisfies(t,"^0.12.3")||atom.notifications.addWarning("Potentially incompatible `ink` version detected.",{description:`Please make sure to upgrade ${Tr} to a version compatible with \`^0.12.3\`.\nThe currently installed version is \`${t}\`.\n\nIf you cannot install an appropriate version via via \`File -> Settings -> Packages\`,\nopen a terminal and run\n\n    apm install ink@x.y.z\n\nwhere \`x.y.z\` is satisfies \`^0.12.3\`.`,dismissable:!0}),e()):atom.notifications.addError("Failed to enable Juno's dependencies.",{description:`Juno requires the ${Tr} and ${Rr} packages.\nPlease install them manually via \`File -> Settings -> Packages\`,\nor open a terminal and run\n\n    apm install ink\n    apm install language-julia\n\nand then restart Atom.`,dismissable:!0}))},config:Dt,deactivate:function(){var e,t,n,i,o;for(i=[],e=0,t=(n=[Lr,Br,Fr,this.connection,this.runtime,this.ui]).length;e<t;e++)o=n[e],i.push(o.deactivate());return i},consumeInk:function(e){var t,n,i,o,r;for(Lr.ink=e,o=[],t=0,n=(i=[this.connection,this.runtime,this.ui]).length;t<n;t++)r=i[t],o.push(r.consumeInk(e));return o},consumeStatusBar:function(e){return this.runtime.consumeStatusBar(e)},consumeToolBar:function(e){return Fr.consumeToolBar(e)},consumeGetServerConfig:function(e){return this.connection.consumeGetServerConfig(e)},consumeGetServerName:function(e){return this.connection.consumeGetServerName(e)},consumeDatatip:function(e){return this.runtime.consumeDatatip(e)},provideClient:function(){return this.connection.client},provideAutoComplete:function(){return this.runtime.provideAutoComplete()},provideHyperclick:function(){return this.runtime.provideHyperclick()},handleURI:function(e){return this.runtime.handleURI(e)}};module.exports=Vr;
//# sourceMappingURL=julia-client.js.map
